
DATA: PEDAGIO     TYPE REF TO ZCL_REPOM_VIAGEM_VPR,
      I_FILTROS   TYPE ZDE_ZLEST0123_FILTRO,
      LC_IDENTI   TYPE ZDE_ID_PROC_CLIENTE_R,
      E_REGISTROS TYPE ZDE_ZLEST0123_ALV_T.

CLEAR: TXT_PLACA_01, TXT_PLACA_02, TXT_PLACA_03, TXT_PLACA_04.

CREATE OBJECT PEDAGIO.

PEDAGIO->SET_REGISTRO( EXPORTING I_ID_REGISTRO = I_ID_PROC_CLIENTE ).

PEDAGIO->GET_REGISTRO( IMPORTING E_REGISTRO = CABECALHO ).

IT_DOCUMENTOS = PEDAGIO->GET_DOCUMENTOS( ).

IT_PRACAS = PEDAGIO->GET_PRACAS( ).

LC_IDENTI-SIGN   = 'I'.
LC_IDENTI-OPTION = 'EQ'.
LC_IDENTI-LOW    = I_ID_PROC_CLIENTE.
LC_IDENTI-HIGH   = I_ID_PROC_CLIENTE.
APPEND LC_IDENTI TO I_FILTROS-ID_PROC_CLIENTE.

PEDAGIO->PESQUISAR( EXPORTING I_FILTROS = I_FILTROS IMPORTING E_REGISTROS = E_REGISTROS ).

READ TABLE E_REGISTROS INDEX 1 INTO CABECALHO_ALV.

IF CABECALHO_ALV-VEICULO_PLACA IS NOT INITIAL.
  CONCATENATE CABECALHO_ALV-VEICULO_PLACA '-' CABECALHO_ALV-VEICULO_EIXOS
         INTO TXT_PLACA_01.
ENDIF.

IF CABECALHO_ALV-VEICULO_PLACA_C1 IS NOT INITIAL.
  CONCATENATE CABECALHO_ALV-VEICULO_PLACA_C1 '-' CABECALHO_ALV-VEICULO_EIXOS_C1
         INTO TXT_PLACA_02.
ENDIF.

IF CABECALHO_ALV-VEICULO_PLACA_C2 IS NOT INITIAL.
  CONCATENATE CABECALHO_ALV-VEICULO_PLACA_C2 '-' CABECALHO_ALV-VEICULO_EIXOS_C2
         INTO TXT_PLACA_03.
ENDIF.

IF CABECALHO_ALV-VEICULO_PLACA_C3 IS NOT INITIAL.
  CONCATENATE CABECALHO_ALV-VEICULO_PLACA_C3 '-' CABECALHO_ALV-VEICULO_EIXOS_C3
         INTO TXT_PLACA_04.
ENDIF.

CONCATENATE SY-UNAME '-' SY-DATUM '-' SY-UZEIT INTO TXT_RODAPE
 SEPARATED BY SPACE.

DATA: WA_USR21 TYPE USR21,
      WA_ADRP  TYPE ADRP.

TXT_NOME_FUNCIONARIO = SY-UNAME.

SELECT SINGLE * INTO WA_USR21
  FROM USR21
 WHERE BNAME EQ SY-UNAME.

IF SY-SUBRC IS INITIAL.

  SELECT SINGLE * INTO WA_ADRP
    FROM ADRP
   WHERE PERSNUMBER EQ WA_USR21-PERSNUMBER.

  IF SY-SUBRC IS INITIAL.
    TXT_NOME_FUNCIONARIO = WA_ADRP-NAME_TEXT.
  ENDIF.

ENDIF.
