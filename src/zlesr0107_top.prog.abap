*&---------------------------------------------------------------------*
*&  Include           ZLESR0107_TOP
*&---------------------------------------------------------------------*


REPORT ZLESR0107.

TABLES: ZLEST0140, ZLEST0198.

TYPE-POOLS: ICON.

TYPES: BEGIN OF TY_EDITOR,
         LINE(72),
       END   OF TY_EDITOR.

TYPES: BEGIN OF TY_SAIDA_0100,
         NOVO_REG        TYPE C,
         ANEXO           TYPE C LENGTH 4,
         ANEXO_LINK      TYPE SIBFBORIID,
         ANEXO_G         TYPE C LENGTH 4,
         ANEXO_LINK_G    TYPE SIBFBORIID,
         PERC_GRAOS_REAL TYPE ZLEST0140-PERC_GRAOS,
         VL_GRAOS_REAL   TYPE ZLEST0140-VALOR,
         PERC_FERT_REAL  TYPE ZLEST0140-PERC_FERT,
         VL_FERT_REAL    TYPE ZLEST0140-VALOR,
         PERC_DEF_REAL   TYPE ZLEST0140-PERC_DEF,
         VL_DEF_REAL     TYPE ZLEST0140-VALOR,
         PERC_SEM_REAL   TYPE ZLEST0140-PERC_SEM,
         VL_SEM_REAL     TYPE ZLEST0140-VALOR,
         COLOR           TYPE KKBLO_SPECIALCOL OCCURS 0.
         INCLUDE STRUCTURE ZLEST0140.
       TYPES END OF TY_SAIDA_0100.

TYPES: BEGIN OF Y_ZLEST0140,
         BUKRS      TYPE ZLEST0140-BUKRS,
         DATA       TYPE ZLEST0140-DATA,
         VALOR_DE   TYPE ZLEST0140-VALOR,
         VALOR_PARA TYPE ZLEST0140-VALOR,
         TIP_OPER   TYPE CHAR20,
         OBS        TYPE ZLEST0140-OBSERV.
TYPES END OF Y_ZLEST0140.

TYPES: BEGIN OF TY_ZLEST0140,
         ANEXO_EMP_FORN TYPE C LENGTH 14.
         INCLUDE STRUCTURE ZLEST0140.
       TYPES END OF TY_ZLEST0140.



DATA: EDITOR   TYPE REF TO CL_GUI_TEXTEDIT,
      C_EDITOR TYPE REF TO CL_GUI_CUSTOM_CONTAINER,
      TXTOPEN  TYPE C,
      OK_CODE  LIKE SY-UCOMM.




TYPES: BEGIN OF TY_CAB_0100,
         BUKRS      TYPE ZLEST0140-BUKRS,
         LIFNR      TYPE ZLEST0140-LIFNR,
         DT_INI     TYPE ZLEST0140-DATA,
         DT_FIM     TYPE ZLEST0140-DATA,
         VALOR      TYPE ZLEST0140-VALOR,
         OBSERV     TYPE ZLEST0140-OBSERV,
         NAME1      TYPE LFA1-NAME1,
         BUTXT      TYPE T001-BUTXT,
         ANEXO_LINK TYPE SIBFLPORB-INSTID.
TYPES  END OF TY_CAB_0100.

*---------------------------------------------------------------------*
*  Inicio Definition Classes
*---------------------------------------------------------------------*

CLASS LCL_ALV_TOOLBAR_0100 DEFINITION.
  PUBLIC SECTION.
*Constructor
    METHODS: CONSTRUCTOR
      IMPORTING IO_ALV_GRID TYPE REF TO CL_GUI_ALV_GRID,
*Event for toolbar
      ON_TOOLBAR FOR EVENT TOOLBAR OF CL_GUI_ALV_GRID
        IMPORTING E_OBJECT,

      HANDLE_USER_COMMAND FOR EVENT USER_COMMAND OF CL_GUI_ALV_GRID
        IMPORTING E_UCOMM.

ENDCLASS.                    "LCL_ALV_TOOLBAR DEFINITION

CLASS LCL_EVENT_HANDLER_0100 DEFINITION.
  PUBLIC SECTION.

    CLASS-METHODS:
      CATCH_HOTSPOT FOR EVENT HOTSPOT_CLICK OF CL_GUI_ALV_GRID
        IMPORTING E_ROW_ID E_COLUMN_ID ES_ROW_NO,

      HANDLE_BUTTON_CLICK FOR EVENT BUTTON_CLICK OF CL_GUI_ALV_GRID
        IMPORTING ES_COL_ID ES_ROW_NO.

ENDCLASS.



DATA: OBJ_ALV_0100       TYPE REF TO CL_GUI_ALV_GRID,
      OBJ_CONTAINER_0100 TYPE REF TO CL_GUI_CUSTOM_CONTAINER.
DATA: OBJ_ALV_0200       TYPE REF TO CL_GUI_ALV_GRID,
      OBJ_CONTAINER_0200 TYPE REF TO CL_GUI_CUSTOM_CONTAINER.

DATA: GT_CATALOG TYPE LVC_T_FCAT,
      GW_CATALOG TYPE LVC_S_FCAT.

DATA: OBJ_TOOLBAR_0100 TYPE REF TO LCL_ALV_TOOLBAR_0100.
*DATA: OBJ_TOOLBAR_0200 TYPE REF TO LCL_ALV_TOOLBAR_0200.

* ALV field catalogs
DATA: IT_FCAT TYPE LVC_T_FCAT,
      WA_FCAT TYPE LVC_S_FCAT.

DATA: IT_FCA TYPE LVC_T_FCAT,
      WA_FCA TYPE LVC_S_FCAT.

* ALV excluded functions
DATA: IT_EXCLUDE_FCODE TYPE UI_FUNCTIONS,
      WA_EXCLUDE_FCODE LIKE LINE OF IT_EXCLUDE_FCODE.

* Alv Styles
DATA: LS_EDIT TYPE LVC_S_STYL,
      LT_EDIT TYPE LVC_T_STYL.

* ALV layout variant
DATA: GS_VARIANT       TYPE DISVARIANT.

* ALV layout
DATA: GS_LAYOUT        TYPE LVC_S_LAYO.

* ALV Stable
DATA: WA_STABLE        TYPE LVC_S_STBL.

DATA: IT_SELECTEDCELL TYPE LVC_T_CELL,
      WA_SELECTEDCELL TYPE LVC_S_CELL.

DATA: IT_SEL_ROWS TYPE LVC_T_ROW,
      WA_SEL_ROWS TYPE LVC_S_ROW.

DATA: TL_TEXTO           TYPE CATSXT_LONGTEXT_ITAB,
      VL_OBSERVACAO(500).

DATA: GT_ESTILO TYPE LVC_T_STYL WITH HEADER LINE,
      WL_ESTILO TYPE LVC_S_STYL.

DATA: GT_F4  TYPE LVC_T_F4 WITH HEADER LINE.

* Objetos
DATA: C_ALV_TOOLBARMANAGER TYPE REF TO CL_ALV_GRID_TOOLBAR_MANAGER,
      TY_TOOLBAR           TYPE STB_BUTTON.

DATA: BLOCK     TYPE C,
      IT_EDITOR TYPE TABLE OF TY_EDITOR,
      WA_EDITOR TYPE TY_EDITOR.

*-------------------------------------------------------------------
* Tabelas Internas and Work Areas.
*-------------------------------------------------------------------
DATA: BEGIN OF TG_ANEXOS OCCURS 0.
        INCLUDE STRUCTURE SRGBTBREL.
      DATA: END OF TG_ANEXOS.

DATA: IT_SAIDA_0100    TYPE TABLE OF TY_SAIDA_0100,
      TG_ZLEST0140     TYPE TABLE OF TY_ZLEST0140 WITH HEADER LINE,
      TG_ZLEST0141_RES TYPE TABLE OF ZLEST0141_RESUMO WITH HEADER LINE,
      WA_SAIDA_0100    TYPE TY_SAIDA_0100,
      W_ZLEST0140      TYPE Y_ZLEST0140,
      WA_CAB_0100      TYPE TY_CAB_0100,
      WA_CAB_01001     TYPE TY_CAB_0100,
      TG_PARAMETROS    TYPE USTYP_T_PARAMETERS WITH HEADER LINE.

DATA: T_TEMP     TYPE TABLE OF TY_SAIDA_0100.

DATA: T_LOG TYPE TABLE OF ZLEST0198.
DATA: W_LOG TYPE ZLEST0198.
DATA: DESVIO(8)  TYPE C.             " Desvio

DATA: VG_OPERACAO TYPE C LENGTH 10,
      VAR_ANSWER  TYPE C.

CONSTANTS: C_VIEW VALUE 'VIEW' TYPE C LENGTH 10,
           C_EDIT VALUE 'EDIT' TYPE C LENGTH 10,
           C_DEL  VALUE 'DEL' TYPE C LENGTH 10.

INITIALIZATION.

  VG_OPERACAO = C_VIEW.

  CALL FUNCTION 'SUSR_USER_PARAMETERS_GET'
    EXPORTING
      USER_NAME           = SY-UNAME
    TABLES
      USER_PARAMETERS     = TG_PARAMETROS
    EXCEPTIONS
      USER_NAME_NOT_EXIST = 1
      OTHERS              = 2.

  CALL SCREEN 0100.
