FUNCTION Z_DRE_SYSPHERA.
*"----------------------------------------------------------------------
*"*"Interface local:
*"  IMPORTING
*"     REFERENCE(I_BUKRS) TYPE  BUKRS
*"     REFERENCE(I_GJAHR) TYPE  GJAHR
*"     REFERENCE(I_MONAT) TYPE  MONAT
*"     REFERENCE(I_VERSN) TYPE  VERSN_011
*"     REFERENCE(I_KOKRS) TYPE  KOKRS
*"  TABLES
*"      RESULTADO STRUCTURE  ZSYS_DRE
*"----------------------------------------------------------------------

  DATA: IT_EXCEL          TYPE TABLE OF ZGL030_EST_D WITH HEADER LINE.
  DATA: IT_EXCEL_USD      TYPE TABLE OF ZGL030_EST_D WITH HEADER LINE.
  DATA: W_RESULTADO       TYPE ZSYS_DRE.
  CALL FUNCTION 'Z_PESQUISA_DRE'
    EXPORTING
      I_BUKRS      = I_BUKRS
      I_GJAHR      = I_GJAHR
      I_MONATI     = I_MONAT
      I_MONATF     = I_MONAT
      I_VERSN      = I_VERSN
      I_WAERS      = 'BRL'
    TABLES
      T_ZGL030_EST = IT_EXCEL.

  CALL FUNCTION 'Z_PESQUISA_DRE'
    EXPORTING
      I_BUKRS      = I_BUKRS
      I_GJAHR      = I_GJAHR
      I_MONATI     = I_MONAT
      I_MONATF     = I_MONAT
      I_VERSN      = I_VERSN
      I_WAERS      = 'USD'
    TABLES
      T_ZGL030_EST = IT_EXCEL_USD.

  DELETE IT_EXCEL     WHERE SAKNR IS INITIAL.
  DELETE IT_EXCEL_USD WHERE SAKNR IS INITIAL.
  LOOP AT IT_EXCEL_USD.
    MOVE-CORRESPONDING IT_EXCEL_USD TO IT_EXCEL.
    IT_EXCEL-KOSAR = 'D'.
    APPEND IT_EXCEL.
  ENDLOOP.
  DATA: VLR_REA(20),

        WL_CONT      TYPE SY-TABIX,
        TX_AUX       TYPE C,
        IT_EXCEL_AUX LIKE TABLE OF IT_EXCEL WITH HEADER LINE.

  DATA: V_LOOPI    TYPE I,
        V_LOOPF    TYPE I,
        V_MESAN    TYPE I,
        V_REAC(10),
        V_MES(02).

  FIELD-SYMBOLS: <FS_REA> TYPE ANY.

  DELETE IT_EXCEL WHERE SAKNR IS INITIAL.
  LOOP AT IT_EXCEL.

    V_LOOPI = I_MONAT.
    V_LOOPF = I_MONAT.
    IF V_LOOPF = 0.
      V_LOOPF = V_LOOPI.
    ENDIF.
    CLEAR:  VLR_REA.
    WHILE V_LOOPI LE V_LOOPF.
      V_MES = V_LOOPI.
      CALL FUNCTION 'CONVERSION_EXIT_ALPHA_INPUT'
        EXPORTING
          INPUT  = V_MES
        IMPORTING
          OUTPUT = V_MES.
      CONCATENATE 'VLR_REA' V_MES INTO V_REAC.

      ASSIGN COMPONENT V_REAC OF STRUCTURE IT_EXCEL TO <FS_REA>.
      "
      ADD 1 TO V_LOOPI.
    ENDWHILE.
    W_RESULTADO-ANO             = I_GJAHR.
    W_RESULTADO-MES             = I_MONAT.
    W_RESULTADO-CENTRO_CUSTO    = IT_EXCEL-KOSTL.
    SELECT SINGLE LTEXT FROM CSKT INTO W_RESULTADO-NOME_CENTRO
         WHERE SPRAS EQ SY-LANGU AND
               KOKRS EQ I_KOKRS   AND
               KOSTL EQ IT_EXCEL-KOSTL AND
               DATBI GE SY-DATUM .
    W_RESULTADO-COD_CONTA       = IT_EXCEL-SAKNR.
    W_RESULTADO-NOME_CONTA      = IT_EXCEL-TXT50.
    CONCATENATE IT_EXCEL-NIVEL '-' IT_EXCEL-SAKNR INTO W_RESULTADO-ID_CONCATENADO.
*    W_RESULTADO-COD_PRODUTO     = IT_EXCEL-.
    W_RESULTADO-NOME_PRODUTO    = IT_EXCEL-NITXT.
    IF IT_EXCEL-KOSAR NE 'D'.
      W_RESULTADO-VLR_LOCAL       = <FS_REA>.
    ELSE.
      W_RESULTADO-VLR_DOLAR       = <FS_REA>.
    ENDIF.
    IF <FS_REA> = 0.
      CONTINUE.
    ENDIF.
    COLLECT W_RESULTADO INTO RESULTADO.
    CLEAR W_RESULTADO.
  ENDLOOP.



ENDFUNCTION.
