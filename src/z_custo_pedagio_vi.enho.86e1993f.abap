"Name: \PR:SAPLV61A\FO:FRM_KOND_BASIS_901\SE:BEGIN\EI
ENHANCEMENT 0 Z_CUSTO_PEDAGIO_VI.
*
  FIELD-SYMBOLS: <FIELD_NEW> TYPE ANY TABLE.

  TYPES :
     BEGIN OF Y_VBFA_NEW,
             VBELV    TYPE VBFA-VBELV,
             POSNV    TYPE VBFA-POSNV,
             VBELN    TYPE J_1BNFLIN-REFKEY,
             POSNN    TYPE J_1BNFLIN-ITMNUM,
             VBTYP_N  TYPE VBFA-VBTYP_N,
             VBTYP_V  TYPE VBFA-VBTYP_V,
     END OF Y_VBFA_NEW,

     BEGIN OF Y_VTTP_NEW,
           TKNUM   TYPE VTTK-TKNUM,
     END OF Y_VTTP_NEW.

  DATA: TI_VFSI_NEW      TYPE TABLE OF VFSIVB  WITH HEADER LINE,
        TI_VTTP_NEW      TYPE TABLE OF Y_VTTP_NEW  WITH HEADER LINE,
        VL_PEDAGIO_NEW   TYPE ZLEST0026-PEDAGIO,
        VL_VBFA_NEW      TYPE Y_VBFA_NEW,
        VL_TKNUM_NEW     TYPE VTTK-TKNUM,
        VL_FIELD_NEW(20) TYPE C.

  CLEAR: VL_VBFA_NEW, VL_PEDAGIO_NEW , VL_TKNUM_NEW, VL_FIELD_NEW, TI_VFSI_NEW, TI_VTTP_NEW.

  REFRESH: TI_VFSI_NEW, TI_VTTP_NEW.

* Determinação do documento de transporte
  VL_FIELD_NEW = '(SAPLV54B)G_VFSI[]'.
  ASSIGN (VL_FIELD_NEW) TO <FIELD_NEW>.

* Controle de remessa
  IF <FIELD_NEW> IS  ASSIGNED.

    TI_VFSI_NEW[] = <FIELD_NEW>[].

    READ TABLE TI_VFSI_NEW INDEX 1.

* Condições: dados independentes da dimensão
    SELECT MAX( TKNUM )
      INTO TABLE TI_VTTP_NEW
      FROM VTTP
     WHERE VBELN = TI_VFSI_NEW-VBELN.

    DELETE ADJACENT DUPLICATES FROM TI_VTTP_NEW.

* Documento de transporte
    READ TABLE TI_VTTP_NEW INTO VL_TKNUM_NEW INDEX 1.

    IF SY-SUBRC IS INITIAL.
      SELECT SINGLE PEDAGIO
        INTO VL_PEDAGIO_NEW
        FROM  ZLEST0026
       WHERE TKNUM = VL_TKNUM_NEW.

      IF SY-SUBRC IS INITIAL.
        XKOMV-KBETR = VL_PEDAGIO_NEW.
        MODIFY XKOMV.
      ENDIF.
    ENDIF.
  ENDIF.


  CHECK 1 EQ 2.

ENDENHANCEMENT.
