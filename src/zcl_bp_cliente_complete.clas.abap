class ZCL_BP_CLIENTE_COMPLETE definition
  public
  final
  create public .

public section.

  interfaces IF_BADI_INTERFACE .
  interfaces IF_EX_CUSTOMER_EXTENSION_COMPL .
protected section.
private section.
ENDCLASS.



CLASS ZCL_BP_CLIENTE_COMPLETE IMPLEMENTATION.


  METHOD IF_EX_CUSTOMER_EXTENSION_COMPL~COMPLETE.

****** SAP x VIP Integration
    IF CS_CUSTOMER-KNA1-NEW_DATA IS NOT INITIAL.

*** BUG - 141884 - Inicio - CBRAND
** Casos em que o update n√£o esta trigger na cs_vendor
      IF CS_CUSTOMER-KNA1-UPD <> 'U'.
        SELECT * FROM BUT000
         INTO TABLE @DATA(LIT_BUT000)
          WHERE PARTNER EQ @CS_CUSTOMER-KNA1-NEW_DATA-KUNNR
              AND CHDAT EQ @SY-DATUM.
        IF SY-SUBRC = 0.
          CS_CUSTOMER-KNA1-UPD = 'U'.
        ENDIF.
      ENDIF.
*** BUG - 141884 - Fim - CBRAND

      CALL FUNCTION 'ZFI_VIP_COUNTERPARTIES'
        EXPORTING
          I_KNA1     = CS_CUSTOMER-KNA1-NEW_DATA    " Mestre de clientes (parte geral)
          I_CREATION = COND #( WHEN CS_CUSTOMER-KNA1-UPD = 'U' THEN ABAP_FALSE ELSE ABAP_TRUE ).

    ENDIF.

*-US 135191-18-06-2024-#135191-RJF-inicio
    DATA: LV_AC_TERMO_AL5BANK TYPE C,
          LT_KNA1             TYPE STANDARD TABLE OF KNA1,
          LW_KNA1X            TYPE KNA1.

    CLEAR: LV_AC_TERMO_AL5BANK.
    IMPORT LV_AC_TERMO_AL5BANK TO LV_AC_TERMO_AL5BANK FROM MEMORY ID 'AC_TERMO_AL5BANK'.
    DELETE FROM MEMORY ID 'AC_TERMO_AL5BANK'.

*"// wbarbosa BUG-165542 03/02/2025
    DATA: VL_KUNNR TYPE KUNNR.
    DATA: E_PROTOCOLO TYPE ZMME0005.

    VL_KUNNR = |{ CS_CUSTOMER-KNA1-NEW_DATA-KUNNR ALPHA = IN }|.
    IMPORT PROTOCOLO TO E_PROTOCOLO FROM  MEMORY ID VL_KUNNR.
*
    IF E_PROTOCOLO IS NOT INITIAL.
      FREE MEMORY ID VL_KUNNR.
    ENDIF.
*"// wbarbosa BUG-165542 03/02/2025

    IF LV_AC_TERMO_AL5BANK EQ ABAP_TRUE.
      IF CS_CUSTOMER-KNA1-NEW_DATA-KUNNR IS NOT INITIAL.
        LW_KNA1X-LIFNR = CS_CUSTOMER-KNA1-NEW_DATA-KUNNR.
        LW_KNA1X-KUNNR = CS_CUSTOMER-KNA1-NEW_DATA-KUNNR.
        APPEND LW_KNA1X TO LT_KNA1.
      ENDIF.
      CALL FUNCTION 'ZBP_ACEITE_TERMO' STARTING NEW TASK '1' "IN UPDATE TASK
*"// wbarbosa BUG-165542 03/02/2025
        EXPORTING
          I_PROTOCOLO      = E_PROTOCOLO-PROTOCOLO
          I_ACEITE         = E_PROTOCOLO-ACEITE
*"// wbarbosa BUG-165542 03/02/2025
        TABLES
          I_FORNECEDOR_SAP = LT_KNA1[].

    ENDIF.
*-US 135191-18-06-2024-#135191-RJF-fim
  ENDMETHOD.
ENDCLASS.
