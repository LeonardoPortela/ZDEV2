*&---------------------------------------------------------------------*
*&  Include           ZLESR0119_TOP
*&---------------------------------------------------------------------*

REPORT ZLESR0119.



TABLES: ZSDT0001,T001W, LFA1, ZLEST0158.

TYPES: BEGIN OF TY_ESTRUTURA.
        INCLUDE TYPE SLIS_FIELDCAT_MAIN.
        INCLUDE TYPE SLIS_FIELDCAT_ALV_SPEC.
TYPES: END OF TY_ESTRUTURA.

TYPES: BEGIN OF TY_SAIDA_0100,
         MOTIVO_BAIXA   TYPE ZLEST0158-MOTIVO,
         DT_BAIXA       TYPE ZLEST0158-DT_REGISTRO,
         HR_BAIXA       TYPE ZLEST0158-HR_REGISTRO,
         US_BAIXA       TYPE ZLEST0158-US_REGISTRO,
         NR_DCO         TYPE ZDCO_VINCULO-NR_DCO.
         INCLUDE STRUCTURE ZSDT0001.
TYPES END OF TY_SAIDA_0100.



TYPES: BEGIN OF TY_LFA1,
         LIFNR    TYPE LFA1-LIFNR,
         NAME1    TYPE LFA1-NAME1,
         STCD1    TYPE LFA1-STCD1,
         STCD2    TYPE LFA1-STCD2.
TYPES END OF TY_LFA1.

TYPES: BEGIN OF TY_KNA1,
         KUNNR    TYPE KNA1-KUNNR,
         NAME1    TYPE KNA1-NAME1,
         STCD1    TYPE KNA1-STCD1,
         STCD2    TYPE KNA1-STCD2.
TYPES END OF TY_KNA1.


*---------------------------------------------------------------------*
*  Inicio Definition Classes
*---------------------------------------------------------------------*

CLASS LCL_ALV_TOOLBAR_0100 DEFINITION.
  PUBLIC SECTION.
*Constructor
    METHODS: CONSTRUCTOR
                IMPORTING IO_ALV_GRID TYPE REF TO CL_GUI_ALV_GRID,
*Event for toolbar
    ON_TOOLBAR FOR EVENT TOOLBAR OF CL_GUI_ALV_GRID
               IMPORTING  E_OBJECT,

    HANDLE_USER_COMMAND FOR EVENT USER_COMMAND OF CL_GUI_ALV_GRID
               IMPORTING E_UCOMM.

ENDCLASS.                    "LCL_ALV_TOOLBAR DEFINITION

CLASS LCL_EVENT_HANDLER_0100 DEFINITION.
  PUBLIC SECTION.

    CLASS-METHODS:
      CATCH_HOTSPOT FOR EVENT HOTSPOT_CLICK OF CL_GUI_ALV_GRID
            IMPORTING E_ROW_ID E_COLUMN_ID ES_ROW_NO.
ENDCLASS.

DATA: OBJ_ALV_0100         TYPE REF TO CL_GUI_ALV_GRID,
      OBJ_CONTAINER_0100   TYPE REF TO CL_GUI_CUSTOM_CONTAINER.

DATA: GT_CATALOG       TYPE LVC_T_FCAT,
      GW_CATALOG       TYPE LVC_S_FCAT.

DATA: OBJ_TOOLBAR_0100 TYPE REF TO LCL_ALV_TOOLBAR_0100.

* ALV field catalogs
DATA: IT_FCAT    TYPE LVC_T_FCAT,
      WA_FCAT    TYPE LVC_S_FCAT.

* ALV excluded functions
DATA: IT_EXCLUDE_FCODE TYPE UI_FUNCTIONS,
      WA_EXCLUDE_FCODE LIKE LINE OF IT_EXCLUDE_FCODE.

* Alv Styles
DATA: LS_EDIT         TYPE LVC_S_STYL,
      LT_EDIT         TYPE LVC_T_STYL.

* ALV layout variant
DATA: GS_VARIANT       TYPE DISVARIANT.

* ALV layout
DATA: GS_LAYOUT        TYPE LVC_S_LAYO.

* ALV Stable
DATA: WA_STABLE        TYPE LVC_S_STBL.

DATA: IT_SELECTEDCELL  TYPE LVC_T_CELL,
      WA_SELECTEDCELL  TYPE LVC_S_CELL.

DATA: IT_SEL_ROWS         TYPE LVC_T_ROW,
      WA_SEL_ROWS         TYPE LVC_S_ROW.

DATA: GT_ESTILO   TYPE LVC_T_STYL WITH HEADER LINE,
      WL_ESTILO   TYPE LVC_S_STYL.

DATA: GT_F4  TYPE LVC_T_F4 WITH HEADER LINE.

* Objetos
DATA: C_ALV_TOOLBARMANAGER TYPE REF TO CL_ALV_GRID_TOOLBAR_MANAGER,
      TY_TOOLBAR TYPE STB_BUTTON.

DATA: WA_ESTRUTURA       TYPE TY_ESTRUTURA,
      ESTRUTURA          TYPE TABLE OF TY_ESTRUTURA.

DATA: WL_VRM_VALUE  TYPE VRM_VALUE,
      IT_VRM_VALUE TYPE STANDARD TABLE OF VRM_VALUE.

*-------------------------------------------------------------------
* Tabelas Internas and Work Areas.
*-------------------------------------------------------------------
DATA: IT_SAIDA_0100     TYPE TABLE OF TY_SAIDA_0100,
      WA_SAIDA_0100     TYPE TY_SAIDA_0100,
      TG_ZLEST0158      TYPE TABLE OF ZLEST0158 WITH HEADER LINE,
      TG_ZDCO_VINCULO   TYPE TABLE OF ZDCO_VINCULO WITH HEADER LINE,
      TG_ZSDT0001       TYPE TABLE OF ZSDT0001 WITH HEADER LINE.

*-------------------------------------------------------------------
* Váriaveis
*-------------------------------------------------------------------
DATA: VG_OPERACAO TYPE C LENGTH 20,
      VAR_ANSWER  TYPE C.

*-------------------------------------------------------------------
* Constantes
*-------------------------------------------------------------------
CONSTANTS: C_BAIXAR     TYPE C VALUE 'BAIXAR'       LENGTH 12,
           C_CANC_BAIXA TYPE C VALUE 'CANC_BAIXAR'  LENGTH 12.

*----------------------------------------------------------------------*
* Tela de Seleção
*----------------------------------------------------------------------*
SELECTION-SCREEN: BEGIN OF BLOCK B1 WITH FRAME TITLE TEXT-001.
SELECT-OPTIONS: P_WERKS FOR T001W-WERKS    NO INTERVALS NO-EXTENSION,
                P_LIFNR FOR LFA1-LIFNR     NO INTERVALS NO-EXTENSION,
                P_MATNR FOR ZSDT0001-MATNR NO INTERVALS NO-EXTENSION,
                P_SAFRA FOR ZSDT0001-NR_SAFRA NO INTERVALS NO-EXTENSION.

PARAMETERS: P_TPCLA(2) AS LISTBOX VISIBLE LENGTH 20 OBLIGATORY.

SELECTION-SCREEN BEGIN OF LINE.
PARAMETERS: P_PENDE RADIOBUTTON GROUP RB1 DEFAULT 'X'.
SELECTION-SCREEN COMMENT 3(10) TEXT-002 FOR FIELD   P_PENDE.

PARAMETERS: P_BAIXA RADIOBUTTON GROUP RB1.
SELECTION-SCREEN COMMENT 15(10) TEXT-003 FOR FIELD  P_BAIXA.

PARAMETERS: P_AMBAS RADIOBUTTON GROUP RB1.
SELECTION-SCREEN COMMENT 50(10) TEXT-004 FOR FIELD  P_AMBAS.

SELECTION-SCREEN END OF LINE.

SELECTION-SCREEN: END OF BLOCK B1.

INITIALIZATION.

  WL_VRM_VALUE-KEY  = 'CO'.
  WL_VRM_VALUE-TEXT = 'Convencional'.
  APPEND WL_VRM_VALUE TO IT_VRM_VALUE.

  WL_VRM_VALUE-KEY  = 'R1'.
  WL_VRM_VALUE-TEXT = 'RR'.
  APPEND WL_VRM_VALUE TO IT_VRM_VALUE.

  WL_VRM_VALUE-KEY  = 'R2'.
  WL_VRM_VALUE-TEXT = 'RR2'.
  APPEND WL_VRM_VALUE TO IT_VRM_VALUE.

  CALL FUNCTION 'VRM_SET_VALUES'
    EXPORTING
      ID      = 'P_TPCLA'
      VALUES  = IT_VRM_VALUE
    EXCEPTIONS
      ID_ILLEGAL_NAME = 1
      OTHERS = 2.

START-OF-SELECTION.

  PERFORM: F_SELECIONAR_DADOS,
           F_PROCESSA_DADOS.

 CALL SCREEN 0100.
