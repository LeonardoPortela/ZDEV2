FUNCTION ZLES_CADASTRO_AVSEG_TOKEN_CAD.
*"----------------------------------------------------------------------
*"*"Interface local:
*"  IMPORTING
*"     REFERENCE(I_CONSULTA) TYPE  CHAR01
*"     REFERENCE(I_CD_TOKEN) TYPE  ZDE_CD_TOKEN OPTIONAL
*"  EXPORTING
*"     REFERENCE(I_GRAVOU) TYPE  CHAR01
*"  CHANGING
*"     REFERENCE(I_OB_TOKEN) TYPE REF TO  ZCL_AVERBACAO_SEGURO_TOKEN
*"       OPTIONAL
*"----------------------------------------------------------------------

  IF I_OB_TOKEN IS NOT INITIAL.
    OBJ_TOKEN = I_OB_TOKEN.
  ELSE.
    CREATE OBJECT OBJ_TOKEN.
    IF I_CD_TOKEN IS NOT INITIAL.
      OBJ_TOKEN->SET_REGISTRO( I_ID_REGISTRO = I_CD_TOKEN ).
    ENDIF.
  ENDIF.

  CK_CONSULTA         = I_CONSULTA.
  CK_GRAVADO          = ABAP_FALSE.

  PERFORM CADASTRO_TOKEN.

  IF CK_GRAVADO EQ ABAP_TRUE OR I_CONSULTA IS NOT INITIAL.
    I_OB_TOKEN = OBJ_TOKEN.
    I_GRAVOU = ABAP_TRUE.
  ENDIF.

  CLEAR: OBJ_TOKEN.

  "PERFORM LIMPAR_VARIAVEIS.

  I_GRAVOU = CK_GRAVADO.

ENDFUNCTION.
