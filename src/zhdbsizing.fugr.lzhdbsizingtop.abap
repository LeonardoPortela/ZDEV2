FUNCTION-POOL ZHDBSIZING.                    "MESSAGE-ID ..

TYPE-POOLS: ABAP.
types:
  begin of typ_where_strg,
    fieldname(11)  type c,
    op_eq(3)       type c,
    fieldvalue(53) type c,
    op_and(5)      type c,
  end of typ_where_strg,
    BEGIN OF ty_rs_size,
      column_name(256)  TYPE c,
      keyflag           TYPE keyflag,
    has_index(1)     TYPE c,
      record_count      TYPE dec20,
      variable_size     TYPE dec20,
      fixed_size        TYPE dec20,
      est_ms_total      TYPE dec20,
      ms_hl             TYPE dec20,
      est_ms_hl         TYPE dec20,
      typekind          TYPE typekind,
      size_byte      TYPE p LENGTH 9 DECIMALS 2,
      lob_size_byte  TYPE p LENGTH 9 DECIMALS 2,
      dlob_size_byte    TYPE p LENGTH 9 DECIMALS 2,
      dlob_count        TYPE dec20,
      mlob_size_byte    TYPE p LENGTH 9 DECIMALS 2,
      mlob_count        TYPE dec20,
    END OF ty_rs_size,
    BEGIN OF ty_cs_size,
      column_name(256)  TYPE c,
      part_id           TYPE int4,
      keyflag           TYPE keyflag,
    has_index(1)          TYPE c,
*      nopk_type(1)          TYPE c,
    client                TYPE boolean,
      ms_total          TYPE dec20,
      ms_main           TYPE dec20,
      est_ms_main       TYPE dec20,
      record_count      TYPE dec20,
      distinct_count    TYPE dec20,
    low_distinct          TYPE p LENGTH 9 DECIMALS 2,
    loaded(5)             TYPE c,
      index_loaded(16)  TYPE c,
      compression_type(16) TYPE c,
      cs_data_type_name(16) TYPE c,
    load_unit(6)          TYPE c,
    ms_dict               TYPE dec20,
      est_ms_dict       TYPE dec20,
      ms_index          TYPE dec20,
      est_ms_index      TYPE dec20,
      ms_data           TYPE dec20,
      est_ms_data       TYPE dec20,
      ms_misc           TYPE dec20,
      est_ms_misc       TYPE dec20,
      est_ms_hl         TYPE dec20,
      ms_hl             TYPE dec20,
      typekind          TYPE typekind,
      size_byte      TYPE p LENGTH 9 DECIMALS 2,
    opt_size_byte         TYPE p LENGTH 9 DECIMALS 2,
    lob_size_byte         TYPE p LENGTH 9 DECIMALS 2,
      dlob_size_byte    TYPE p LENGTH 9 DECIMALS 2,
      dlob_count        TYPE dec20,
      mlob_size_byte    TYPE p LENGTH 9 DECIMALS 2,
      mlob_count        TYPE dec20,
      spec_count       TYPE dec20,
    END OF ty_cs_size,
    BEGIN OF typ_hana_db_size,
      table_name        TYPE tabname,
      part_id           TYPE int4,
      record_count      TYPE dec20,
      source_size       TYPE p LENGTH 9 DECIMALS 1,
      est_size          TYPE p LENGTH 9 DECIMALS 1,
      est_hl_size       TYPE p LENGTH 9 DECIMALS 1,
      est_age_size      TYPE p LENGTH 9 DECIMALS 1,
      est_pk_size       TYPE p LENGTH 9 DECIMALS 1,
    est_nuk_size      TYPE p LENGTH 9 DECIMALS 1,
      real_size         TYPE p LENGTH 9 DECIMALS 1,
      real_hl_size      TYPE p LENGTH 9 DECIMALS 1,
      real_jec_size     TYPE p LENGTH 9 DECIMALS 1,
      real_esh_size     TYPE p LENGTH 9 DECIMALS 1,
      real_age_size     TYPE p LENGTH 9 DECIMALS 1,
      real_pk_size      TYPE p LENGTH 9 DECIMALS 1,
    real_nuk_size     TYPE p LENGTH 9 DECIMALS 1,
    real_rs_exsize    TYPE p LENGTH 9 DECIMALS 1,
    real_hlrs_exsize  TYPE p LENGTH 9 DECIMALS 1,
    opt_size          TYPE p LENGTH 9 DECIMALS 1,
    return_code       TYPE sysubrc,
    error_message     TYPE char80,
    doubt_reason(2)   TYPE n,
    count_method(1)   TYPE c,
    stat_age          TYPE i,
    records_sampled   TYPE p LENGTH 12 DECIMALS 0,
      documents_sampled TYPE p LENGTH 12 DECIMALS 4,
    db_table          type tabname,
    tab_type          type tabclass,
    nopk_type(1)      type c,
    load_unit(6)      TYPE c,
    bucket            TYPE int2,
      store(2)          TYPE c,
    sogroup(30)       TYPE c,
    clitab            TYPE abap_bool,
      rs_cols           TYPE STANDARD TABLE OF ty_rs_size
                              WITH DEFAULT KEY,
      cs_cols           TYPE STANDARD TABLE OF ty_cs_size
                              WITH DEFAULT KEY,
    END OF typ_hana_db_size,

  begin of typ_columns,
    table_name       type tabname,
    column_name(256)  TYPE c,
    keyflag          type keyflag,
    has_index(1)     TYPE c,
    typekind         TYPE typekind,
    client           TYPE boolean,
    distinct_count   TYPE dec20,
    low_distinct     TYPE p LENGTH 9 DECIMALS 2,
    size_byte        TYPE p LENGTH 9 DECIMALS 2,
    lob_size_byte    TYPE p LENGTH 9 DECIMALS 2,
    opt_size_byte    TYPE p LENGTH 9 DECIMALS 2,
    dlob_size_byte    TYPE p LENGTH 9 DECIMALS 2,
    dlob_count        TYPE dec20,
    mlob_size_byte    TYPE p LENGTH 9 DECIMALS 2,
    mlob_count        TYPE dec20,
    spec_count        TYPE dec20,
  end of typ_columns,

  begin of typ_abap_table_ref,
       tabname      type tabname,
       ref          type ref to data,
       structdescr  type ref to cl_abap_structdescr,
       ddfields     type standard table of dfies with default key,
       table        type typ_hana_db_size,
       keylen       type i,
       intfield     type x031l-fieldname,
       rawfield     type x031l-fieldname,
       where_tab    type standard table of typ_where_strg
                             with default key,
  end of typ_abap_table_ref,

  BEGIN OF typ_rt,
    maxs  type i,
    initime type t,
    currtime  type t,
    lefts type i,
  END OF typ_rt,

  " Sizing of HANA
  BEGIN OF typ_realcs,
    table_name       TYPE tabname,
    column_name(256)  TYPE c,
    part_id          TYPE int4,
    ms_total         TYPE dec20,
    ms_main          TYPE dec20,
    record_count     TYPE dec20,
    distinct_count   TYPE dec20,
    loaded(5)        TYPE c,
    index_loaded(16) TYPE c,
    compression_type(16) TYPE c,
    cs_data_type_name(16) TYPE c,
    load_unit(6)          TYPE c,
    ms_dict               TYPE dec20,
    ms_index         TYPE dec20,
    ms_data          TYPE dec20,
    ms_misc          TYPE dec20,
    ms_hl            TYPE dec20,
    spec_count       TYPE dec20,
  END OF typ_realcs,

  BEGIN OF typ_realrs,
    table_name    TYPE tabname,
    record_count  TYPE dec20,
    variable_size TYPE dec20,
    fixed_size    TYPE dec20,
    ms_hl         TYPE dec20,
  END OF typ_realrs,

  BEGIN OF typ_realrsindex,
    table_name    TYPE tabname,
    index_name    TYPE typ_columns-column_name,
    index_size    TYPE dec20,
  END OF typ_realrsindex,

  typ_t_realrsindex  TYPE STANDARD TABLE OF typ_realrsindex,
  typ_t_realrs       TYPE STANDARD TABLE OF typ_realrs,
  typ_t_realcs       TYPE STANDARD TABLE OF typ_realcs,
 typ_t_hana_db_size type standard table of typ_hana_db_size,
 typ_t_columns      type standard table of typ_columns,

  "Only add num. field to hash tables if important
  "high impact on performance due to collect
  BEGIN OF typ_h_columns,
    table_name       TYPE tabname,
    column_name(256) TYPE c,
    size_byte        TYPE p LENGTH 9 DECIMALS 2,
    opt_size_byte    TYPE p LENGTH 9 DECIMALS 2,
    spec_count       TYPE p LENGTH 9 DECIMALS 6,
  END OF typ_h_columns,
  typ_ht_columns TYPE HASHED TABLE OF typ_h_columns
                        WITH UNIQUE KEY table_name column_name,
  BEGIN OF typ_h_hlcolumns,
    table_name       TYPE tabname,
    column_name(256) TYPE c,
    lob_size_byte    TYPE p LENGTH 9 DECIMALS 2,
    dlob_size_byte   TYPE p LENGTH 9 DECIMALS 2,
    dlob_count       TYPE dec20,
    mlob_size_byte   TYPE p LENGTH 9 DECIMALS 2,
    mlob_count       TYPE dec20,
  END OF typ_h_hlcolumns,
  typ_ht_hlcolumns TYPE HASHED TABLE OF typ_h_hlcolumns
                        WITH UNIQUE KEY table_name column_name.

constants:
  cx_undefined type i value 9999,
  cx_adbc_error type i value 1208.

DATA: en_quad(1) TYPE c.
