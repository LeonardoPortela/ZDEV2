*&---------------------------------------------------------------------*
*&  Include           ZXVVFU02
*&---------------------------------------------------------------------*

* MOD 20121015  Campo Pagador INI -----------------------------------*
DATA :LV_KUNNR LIKE VBPA-KUNNR,
      LV_VBELN LIKE VBAK-VBELN .


SELECT SINGLE VBELN
  FROM VBAK
  INTO LV_VBELN
  WHERE VKORG = VBRK-VKORG AND
        VTWEG = VBRK-VTWEG AND
        SPART = VBRK-SPART AND
        AUART = VBRK-FKART AND
        KUNNR = VBRK-KUNAG AND
        XBLNR = VBRK-XBLNR.

IF SY-SUBRC IS INITIAL.
  SELECT SINGLE KUNNR
    FROM VBPA
    INTO LV_KUNNR
    WHERE VBELN EQ LV_VBELN
    AND PARVW EQ 'Y1'.

  IF SY-SUBRC IS INITIAL.
    XACCIT-EMPFB = LV_KUNNR.
  ENDIF.
ENDIF.
* MOD 20121015  Campo Pagador FIN -----------------------------------*


DATA: WA_SETLEAF  TYPE SETLEAF,
      IT_SETLEAF  LIKE TABLE OF WA_SETLEAF INITIAL SIZE 0 WITH HEADER LINE,
      IT_VBRP     LIKE TABLE OF VBRP INITIAL SIZE 0 WITH HEADER LINE,
      WA_VBRP     LIKE VBRP,
      WA_VBAK     LIKE VBAK.

XACCIT-KDAUF = CVBRP-AUBEL.
XACCIT-KDPOS = CVBRP-AUPOS.

CHECK ( XACCIT-BSCHL EQ '01' ) OR ( XACCIT-BSCHL EQ '11' ).

SELECT * INTO TABLE IT_VBRP
  FROM VBRP
 WHERE VBELN EQ VBRK-VBELN.

CHECK SY-SUBRC IS INITIAL.

READ TABLE IT_VBRP INTO WA_VBRP INDEX 1.

CHECK NOT WA_VBRP-AUBEL IS INITIAL.

SELECT SINGLE * INTO WA_VBAK
  FROM VBAK
 WHERE VBELN EQ WA_VBRP-AUBEL.

CHECK SY-SUBRC IS INITIAL.

SELECT * INTO TABLE IT_SETLEAF
   FROM SETLEAF
  WHERE SETNAME EQ 'SD_INSUMOS'
    AND VALFROM EQ WA_VBAK-AUART.

CHECK SY-SUBRC IS INITIAL.

MOVE WA_VBAK-VGBEL TO XACCIT-ZUONR.
