FUNCTION ZMM_GET_CTE_DISTRIBUIDA.
*"----------------------------------------------------------------------
*"*"Interface local:
*"  IMPORTING
*"     VALUE(I_DATA_INI) TYPE  DATUM
*"     VALUE(I_DATA_FIM) TYPE  DATUM
*"  TABLES
*"      ET_ZIB_CTE_DIST_TER STRUCTURE  ZIB_CTE_DIST_TER
*"----------------------------------------------------------------------

  DATA: LR_RANGE_DATA TYPE RANGE OF DATUM.

  CHECK I_DATA_INI IS NOT INITIAL.


  APPEND VALUE #(  SIGN = 'I'
                   OPTION = 'BT'
                   LOW  = I_DATA_INI
                   HIGH = I_DATA_FIM ) TO LR_RANGE_DATA.

  SELECT *
      FROM ZIB_CTE_DIST_TER
      INTO TABLE ET_ZIB_CTE_DIST_TER
      WHERE DT_ATUALIZACAO IN LR_RANGE_DATA.


  SELECT *
  FROM J_1bnfdoc AS A
  INTO TABLE @DATA(IT_1BNFDOC)
  WHERE CREDAT IN @LR_RANGE_DATA AND
        MODEL EQ '57' AND
         EXISTS ( SELECT DOCNUM_CTE FROM ZIB_CTE_DIST_TER AS B WHERE DOCNUM_CTE EQ A~DOCNUM ).

  IF SY-SUBRC IS INITIAL.

    SELECT *
    FROM ZIB_CTE_DIST_TER
    APPENDING  TABLE ET_ZIB_CTE_DIST_TER FOR ALL ENTRIES IN IT_1BNFDOC
    WHERE DOCNUM_CTE EQ IT_1BNFDOC-DOCNUM.

  ENDIF.

  SORT ET_ZIB_CTE_DIST_TER BY CD_CHAVE_CTE.

  DELETE ADJACENT DUPLICATES FROM ET_ZIB_CTE_DIST_TER COMPARING CD_CHAVE_CTE.


ENDFUNCTION.
