FUNCTION Z_MEMO_ADD_BLS.
*"----------------------------------------------------------------------
*"*"Interface local:
*"  IMPORTING
*"     REFERENCE(P_VGBEL) TYPE  VGBEL
*"  EXPORTING
*"     VALUE(P_PAIS) TYPE  LAND1
*"     VALUE(P_NOMEACAO) TYPE  ZNOM_TRANSPORTE
*"  TABLES
*"      IT_CONHEC STRUCTURE  ZDOC_MEMO_NOMEAC
*"  EXCEPTIONS
*"      PAIS_NAO_ENCONTRADO
*"----------------------------------------------------------------------

  DATA: WA_EXPORTACAO      TYPE ZDOC_EXP,
        WA_ZNOM_CONHEC     TYPE ZNOM_CONHEC,
        WA_CONHEC          TYPE ZDOC_MEMO_NOMEAC,
        WA_BLS             TYPE ZDOC_REM_BL,
        IT_BLS             TYPE TABLE OF ZDOC_REM_BL INITIAL SIZE 0 WITH HEADER LINE.

  CLEAR: P_NOMEACAO, P_PAIS.

  SELECT SINGLE * INTO WA_EXPORTACAO
    FROM ZDOC_EXP
   WHERE VBELN EQ P_VGBEL.

  IF SY-SUBRC EQ 0.

    SELECT *
      INTO CORRESPONDING FIELDS OF TABLE IT_BLS
      FROM ZDOC_REM_BL
     WHERE ID_DOC_EXP EQ WA_EXPORTACAO-ID_DOC_EXP.

    LOOP AT IT_BLS INTO WA_BLS.

      SELECT SINGLE * INTO WA_ZNOM_CONHEC
        FROM ZNOM_CONHEC
       WHERE ID_CONHEC        EQ WA_BLS-ID_CONHEC
         AND ID_NOMEACAO_TRAN EQ WA_BLS-ID_NOMEACAO_TRAN.

      IF SY-SUBRC EQ 0.

        SELECT SINGLE * INTO P_NOMEACAO
          FROM ZNOM_TRANSPORTE
         WHERE ID_NOMEACAO_TRAN EQ WA_ZNOM_CONHEC-ID_NOMEACAO_TRAN.

        CLEAR: WA_CONHEC.
        WA_CONHEC-NR_CONHEC = WA_ZNOM_CONHEC-NR_CONHEC.
        WA_CONHEC-DT_CONHEC = WA_ZNOM_CONHEC-DT_DATA.

        CLEAR: P_PAIS.

        SELECT SINGLE LAND1 INTO P_PAIS
          FROM ZPAIS
         WHERE SG_PAIS_SIGAM EQ WA_ZNOM_CONHEC-SG_PAIS_DESTINO.

        IF ( SY-SUBRC IS NOT INITIAL ) OR ( P_PAIS IS INITIAL ).
          MESSAGE E091 WITH WA_ZNOM_CONHEC-SG_PAIS_DESTINO
                            WA_ZNOM_CONHEC-NR_CONHEC
                    RAISING PAIS_NAO_ENCONTRADO.
        ENDIF.

        APPEND WA_CONHEC TO IT_CONHEC.
      ENDIF.

    ENDLOOP.

  ENDIF.

  IF NOT P_PAIS IS INITIAL.
    SELECT SINGLE LAND1 INTO P_PAIS FROM T005 WHERE LAND1 EQ P_PAIS.
    IF NOT SY-SUBRC IS INITIAL.
      MESSAGE E082 WITH P_PAIS RAISING PAIS_NAO_ENCONTRADO.
    ENDIF.
  ENDIF.

ENDFUNCTION.
