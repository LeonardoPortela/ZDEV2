FUNCTION ZBASIS_SOL_ACESSO_FUNCAO.
*"----------------------------------------------------------------------
*"*"Interface local:
*"  IMPORTING
*"     REFERENCE(I_UNAME) TYPE  UNAME
*"     REFERENCE(I_AGR_NAME) TYPE  AGR_NAME
*"     REFERENCE(I_FROM_DAT) TYPE  MENU_DATE OPTIONAL
*"     REFERENCE(I_TO_DAT) TYPE  MENU_DATE OPTIONAL
*"     REFERENCE(I_IDSOL) TYPE  ZDE_SOLI_FUNCAO OPTIONAL
*"  RAISING
*"      ZCX_USER_PERFIL
*"----------------------------------------------------------------------

  DATA: I_FUNCAO  TYPE BAPIAGR.

  I_FUNCAO-AGR_NAME = I_AGR_NAME.

  IF I_FROM_DAT IS NOT INITIAL.
    I_FUNCAO-FROM_DAT = I_FROM_DAT.
  ELSE.
    I_FUNCAO-FROM_DAT = SY-DATUM.
  ENDIF.

  IF I_TO_DAT IS NOT INITIAL.
    I_FUNCAO-TO_DAT   = I_TO_DAT.
  ELSE.
    I_FUNCAO-TO_DAT   = '99991231'.
  ENDIF.

  ZCL_USER_PERFIL=>ZIF_USER_PERFIL~GET_INSTANCE(
    )->SET_USUARIO( I_USUARIO = I_UNAME
    )->SET_ATRIBUIR_FUNCOES( I_FUNCAO = I_FUNCAO
    ).

  IF I_IDSOL IS NOT INITIAL.
    SELECT SINGLE * INTO @DATA(WA_ZTOPENSIS_004)
      FROM ZTOPENSIS_004
     WHERE ZCOD_FIREFIGHTER EQ @I_IDSOL.

    CHECK SY-SUBRC IS INITIAL.

    WA_ZTOPENSIS_004-ZIND_ATRIBUIR = ABAP_TRUE.
    MODIFY ZTOPENSIS_004 FROM WA_ZTOPENSIS_004.
    COMMIT WORK AND WAIT.
  ENDIF.

ENDFUNCTION.
