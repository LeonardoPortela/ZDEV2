*&---------------------------------------------------------------------*
*& Report  ZHRST_STO_WEBSEMPRE_READ_API
*&
*&---------------------------------------------------------------------*
*&
*&
*&---------------------------------------------------------------------*
REPORT ZHRST_STO_BAIXA_USUARIOS.

DATA:
  LO_WEBSEMPRE TYPE REF TO ZHRST_STO_BAIXA_USUARIOS,
  LS_RETURN    TYPE BAPIRETURN1.

SELECTION-SCREEN: BEGIN OF BLOCK B01 WITH FRAME TITLE TEXT-001.
  PARAMETERS: P_DATINI TYPE DATUM,
              P_DATFIM TYPE DATUM.
SELECTION-SCREEN: END OF BLOCK B01.

START-OF-SELECTION.

  IF P_DATINI IS INITIAL OR P_DATFIM IS INITIAL.
    MESSAGE 'Informar as datas.' TYPE 'S' DISPLAY LIKE 'E'.
    EXIT.
  ENDIF.

  CREATE OBJECT LO_WEBSEMPRE
    EXPORTING
      DATAINI = P_DATINI
      DATAFIM = P_DATFIM.

END-OF-SELECTION.

  "Pega os dados da API
  LS_RETURN = LO_WEBSEMPRE->GET_REQUESTS_FROM_API( ).
  IF LS_RETURN-TYPE EQ LO_WEBSEMPRE->C_ERROR.
    MESSAGE LS_RETURN-MESSAGE TYPE LS_RETURN-TYPE.
    LEAVE LIST-PROCESSING.
  ENDIF.

  "Preenche a tabela interna com os dados
  LS_RETURN = LO_WEBSEMPRE->FILL_TABLE_REQUESTS( ).
  IF LS_RETURN-TYPE EQ LO_WEBSEMPRE->C_ERROR.
    MESSAGE LS_RETURN-MESSAGE TYPE LS_RETURN-TYPE.
    LEAVE LIST-PROCESSING.
  ENDIF.

  "Realiza o COMMIT na tabela transparente (ZHCMT_PA0001)
  LS_RETURN = LO_WEBSEMPRE->COMMIT_WORK( ).
  IF LS_RETURN-TYPE IS NOT INITIAL.
    MESSAGE LS_RETURN-MESSAGE TYPE LS_RETURN-TYPE.
  ENDIF.
