*----------------------------------------------------------------------*
***INCLUDE MZBALANCO_1107 .
*----------------------------------------------------------------------*

DATA: BALANCO_CONTAINER_1107 TYPE REF TO CL_GUI_CUSTOM_CONTAINER,
      BALANCO_ALV_1107       TYPE REF TO CL_GUI_ALV_GRID,
      BALANCO_CATALOGO_1107  TYPE LVC_T_FCAT,
      BALANCO_GS_LAYOUT_1107 TYPE LVC_S_LAYO,
      IT_REMOVIDO TYPE TABLE OF ZDE_FI_GL_SALDO_FAGLFLEXT WITH HEADER LINE.

*&---------------------------------------------------------------------*
*&      Module  STATUS_1107  OUTPUT
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
MODULE STATUS_1107 OUTPUT.

  SET PF-STATUS 'PF1105'.
  SET TITLEBAR  'TL1107'.

  IF BALANCO_CONTAINER_1106 IS INITIAL.

    clear: IT_REMOVIDO[].

    CREATE OBJECT BALANCO_CONTAINER_1107
      EXPORTING
        CONTAINER_NAME = 'ALV_1107'.

    CREATE OBJECT BALANCO_ALV_1107
      EXPORTING
        I_PARENT = BALANCO_CONTAINER_1107.

    MOVE P_GJAHR TO VT_GJAHR.
    MOVE P_MONAT TO VT_MONAT.
    CONCATENATE VT_MONAT '/' VT_GJAHR INTO TEXT01.

    MOVE P_GJAHR TO VG_GJAHR.
    ADD -1 TO VG_GJAHR.
    MOVE VG_GJAHR TO VT_GJAHR.
    MOVE P_MONAT  TO VT_MONAT.
    CONCATENATE VT_MONAT '/' VT_GJAHR INTO TEXT02.

    MOVE P_GJAHR TO VG_GJAHR.
    ADD -1 TO VG_GJAHR.
    MOVE VG_GJAHR TO VT_GJAHR.
    CONCATENATE  '12/' VT_GJAHR INTO TEXT03.

    CLEAR: BALANCO_CATALOGO_1107.

    LOOP AT IT_REMOVIDO_CONA.
      APPEND IT_REMOVIDO_CONA TO IT_REMOVIDO.
    ENDLOOP.

    LOOP AT IT_REMOVIDO_CONS.
      APPEND IT_REMOVIDO_CONS TO IT_REMOVIDO.
    ENDLOOP.

    PERFORM Z_ESTRUTURA_FIELDCAT TABLES BALANCO_CATALOGO_1107 USING:
        'IT_REMOVIDO' 'RYEAR'  'Exercício'             ' ' 01 12 SPACE SPACE SPACE SPACE SPACE SPACE SPACE SPACE,
        'IT_REMOVIDO' 'RBUKRS' 'Empresa'               ' ' 02 12 SPACE SPACE SPACE SPACE SPACE SPACE SPACE SPACE,
        'IT_REMOVIDO' 'RACCT'  'Nº conta'              ' ' 03 12 SPACE SPACE SPACE SPACE SPACE SPACE SPACE SPACE,
        'IT_REMOVIDO' 'RASSC'  'Nº sociedade parceira' ' ' 04 12 SPACE SPACE SPACE SPACE SPACE SPACE SPACE SPACE,
        'IT_REMOVIDO' 'SLVT'   'Saldo'                 ' ' 05 15 SPACE SPACE SPACE SPACE SPACE SPACE SPACE SPACE,
        'IT_REMOVIDO' 'SL01'   'Total 01'              ' ' 06 15 SPACE SPACE SPACE SPACE SPACE SPACE SPACE SPACE,
        'IT_REMOVIDO' 'SL02'   'Total 02'              ' ' 07 15 SPACE SPACE SPACE SPACE SPACE SPACE SPACE SPACE,
        'IT_REMOVIDO' 'SL03'   'Total 03'              ' ' 08 15 SPACE SPACE SPACE SPACE SPACE SPACE SPACE SPACE,
        'IT_REMOVIDO' 'SL04'   'Total 04'              ' ' 09 15 SPACE SPACE SPACE SPACE SPACE SPACE SPACE SPACE,
        'IT_REMOVIDO' 'SL05'   'Total 05'              ' ' 10 15 SPACE SPACE SPACE SPACE SPACE SPACE SPACE SPACE,
        'IT_REMOVIDO' 'SL06'   'Total 06'              ' ' 11 15 SPACE SPACE SPACE SPACE SPACE SPACE SPACE SPACE,
        'IT_REMOVIDO' 'SL07'   'Total 07'              ' ' 12 15 SPACE SPACE SPACE SPACE SPACE SPACE SPACE SPACE,
        'IT_REMOVIDO' 'SL08'   'Total 08'              ' ' 13 15 SPACE SPACE SPACE SPACE SPACE SPACE SPACE SPACE,
        'IT_REMOVIDO' 'SL09'   'Total 09'              ' ' 14 15 SPACE SPACE SPACE SPACE SPACE SPACE SPACE SPACE,
        'IT_REMOVIDO' 'SL10'   'Total 10'              ' ' 15 15 SPACE SPACE SPACE SPACE SPACE SPACE SPACE SPACE,
        'IT_REMOVIDO' 'SL11'   'Total 11'              ' ' 16 15 SPACE SPACE SPACE SPACE SPACE SPACE SPACE SPACE,
        'IT_REMOVIDO' 'SL12'   'Total 12'              ' ' 17 15 SPACE SPACE SPACE SPACE SPACE SPACE SPACE SPACE,
        'IT_REMOVIDO' 'SL13'   'Total 13'              ' ' 18 15 SPACE SPACE SPACE SPACE SPACE SPACE SPACE SPACE,
        'IT_REMOVIDO' 'SL14'   'Total 14'              ' ' 19 15 SPACE SPACE SPACE SPACE SPACE SPACE SPACE SPACE,
        'IT_REMOVIDO' 'SL15'   'Total 15'              ' ' 20 15 SPACE SPACE SPACE SPACE SPACE SPACE SPACE SPACE,
        'IT_REMOVIDO' 'SL16'   'Total 16'              ' ' 21 15 SPACE SPACE SPACE SPACE SPACE SPACE SPACE SPACE.

    CLEAR: BALANCO_GS_LAYOUT_1107.
    BALANCO_GS_LAYOUT_1107-ZEBRA    = ABAP_TRUE.
    BALANCO_GS_LAYOUT_1107-SEL_MODE = 'A'.
    BALANCO_GS_LAYOUT_1107-ZEBRA    = abap_true.

    CALL METHOD BALANCO_ALV_1107->SET_TABLE_FOR_FIRST_DISPLAY
      EXPORTING
        I_DEFAULT       = SPACE
        IS_LAYOUT       = BALANCO_GS_LAYOUT_1107
      CHANGING
        IT_FIELDCATALOG = BALANCO_CATALOGO_1107
        IT_OUTTAB       = IT_REMOVIDO[].

  ENDIF.

  CALL METHOD BALANCO_ALV_1107->REFRESH_TABLE_DISPLAY.

ENDMODULE.                 " STATUS_1107  OUTPUT

*&---------------------------------------------------------------------*
*&      Module  USER_COMMAND_1107  INPUT
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
MODULE USER_COMMAND_1107 INPUT.
  IF BALANCO_ALV_1107 IS NOT INITIAL.
    CALL METHOD BALANCO_ALV_1107->FREE.
  ENDIF.

  IF BALANCO_CONTAINER_1107 IS NOT INITIAL.
    CALL METHOD BALANCO_CONTAINER_1107->FREE.
  ENDIF.

  CLEAR: BALANCO_ALV_1107, BALANCO_CONTAINER_1107.

  LEAVE TO SCREEN 0.
ENDMODULE.                 " USER_COMMAND_1107  INPUT
