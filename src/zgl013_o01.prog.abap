*&---------------------------------------------------------------------*
*&  Include           ZGL013_O01
*&---------------------------------------------------------------------*

*&SPWIZARD: OUTPUT MODULE FOR TS 'TS_100'. DO NOT CHANGE THIS LINE!
*&SPWIZARD: SETS ACTIVE TAB
MODULE TS_100_ACTIVE_TAB_SET OUTPUT.
  TS_100-ACTIVETAB = G_TS_100-PRESSED_TAB.
  CASE G_TS_100-PRESSED_TAB.
    WHEN C_TS_100-TAB1.
      G_TS_100-SUBSCREEN = '0101'.
    WHEN C_TS_100-TAB2.
      G_TS_100-SUBSCREEN = '0102'.
    WHEN OTHERS.
*&SPWIZARD:      DO NOTHING
  ENDCASE.
ENDMODULE.                    "TS_100_ACTIVE_TAB_SET OUTPUT

*&---------------------------------------------------------------------*
*&      Module  STATUS_0100  OUTPUT
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
MODULE STATUS_0100 OUTPUT.
  DATA: FCODE TYPE TABLE OF SY-UCOMM.

  REFRESH: FCODE.

  IF WG_ACAO IS INITIAL.
    APPEND C_SAVE TO FCODE.
    APPEND C_DELDOC TO FCODE.
  ENDIF.

  SET PF-STATUS 'Z001' EXCLUDING FCODE.
  CALL METHOD CL_GUI_CFW=>DISPATCH.
  SET TITLEBAR 'Z001'.

ENDMODULE.                 " STATUS_0100  OUTPUT

*&---------------------------------------------------------------------*
*&      Module  CRIA_OBJETOS  OUTPUT
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
MODULE CRIA_OBJETOS OUTPUT.
  DATA: EVENT       TYPE CNTL_SIMPLE_EVENT,
        EVENTS      TYPE CNTL_SIMPLE_EVENTS,
        TL_FILTER   TYPE LVC_T_FILT,
        WL_FILTER   TYPE LVC_S_FILT,
        TL_FUNCTION TYPE UI_FUNCTIONS,
        WL_FUNCTION LIKE TL_FUNCTION  WITH HEADER LINE,

        LT_F4       TYPE LVC_T_F4     WITH HEADER LINE.

  DATA: WAREF TYPE REF TO DATA.

  WA_STABLE-ROW = 'X'.
  WA_STABLE-COL = 'X'.

  IF G_CUSTOM_CONTAINER IS INITIAL.
    WA_LAYOUT-CWIDTH_OPT = C_X.
    WA_LAYOUT-ZEBRA       = C_X.
*    WA_LAYOUT-NO_TOOLBAR  = C_X.
    WA_LAYOUT-NO_ROWMARK  = SPACE.
    WA_LAYOUT-COL_OPT     = C_X.
    WA_STABLE-ROW         = C_X.
    WA_LAYOUT-SEL_MODE    = 'A'.
    WA_LAYOUT-BOX_FNAME   = 'MARK'.

*    WA_LAYOUT-NO_ROWMOVE  = 'X'.
*    WA_LAYOUT-SGL_CLK_HD  = C_X.


    CREATE OBJECT G_CUSTOM_CONTAINER
      EXPORTING
        CONTAINER_NAME = G_CONTAINER.

    CREATE OBJECT SPLITTER
      EXPORTING
        PARENT  = G_CUSTOM_CONTAINER
        ROWS    = 2
        COLUMNS = 1.

    CALL METHOD SPLITTER->GET_CONTAINER
      EXPORTING
        ROW       = 1
        COLUMN    = 1
      RECEIVING
        CONTAINER = CONTAINER_1.

    CREATE OBJECT GRID1
      EXPORTING
        I_PARENT = CONTAINER_1.

    CREATE OBJECT OBG_TOOLBAR
      EXPORTING
        IO_ALV_GRID = GRID1.

*      * Register event handler
    SET HANDLER OBG_TOOLBAR->ON_TOOLBAR FOR GRID1.
    SET HANDLER OBG_TOOLBAR->HANDLE_USER_COMMAND FOR GRID1.

    WL_FUNCTION = CL_GUI_ALV_GRID=>MC_FC_LOC_DELETE_ROW.
    APPEND WL_FUNCTION TO TL_FUNCTION.
    WL_FUNCTION = CL_GUI_ALV_GRID=>MC_FC_LOC_INSERT_ROW.
    APPEND WL_FUNCTION TO TL_FUNCTION.
    WL_FUNCTION = CL_GUI_ALV_GRID=>MC_FC_LOC_MOVE_ROW.
    APPEND WL_FUNCTION TO TL_FUNCTION.
    WL_FUNCTION = CL_GUI_ALV_GRID=>MC_FC_LOC_PASTE.
    APPEND WL_FUNCTION TO TL_FUNCTION.
    WL_FUNCTION = CL_GUI_ALV_GRID=>MC_FC_LOC_PASTE_NEW_ROW.
    APPEND WL_FUNCTION TO TL_FUNCTION.
    WL_FUNCTION = CL_GUI_ALV_GRID=>MC_FC_LOC_UNDO.
    APPEND WL_FUNCTION TO TL_FUNCTION.
    WL_FUNCTION = CL_GUI_ALV_GRID=>MC_FC_LOC_APPEND_ROW.
    APPEND WL_FUNCTION TO TL_FUNCTION.
    WL_FUNCTION = CL_GUI_ALV_GRID=>MC_FC_LOC_COPY.
    APPEND WL_FUNCTION TO TL_FUNCTION.
    WL_FUNCTION = CL_GUI_ALV_GRID=>MC_FC_LOC_COPY_ROW.
    APPEND WL_FUNCTION TO TL_FUNCTION.
    WL_FUNCTION = CL_GUI_ALV_GRID=>MC_FC_LOC_CUT.
    APPEND WL_FUNCTION TO TL_FUNCTION.
    WL_FUNCTION = CL_GUI_ALV_GRID=>MC_FC_LOC_CUT.
    APPEND WL_FUNCTION TO TL_FUNCTION.
    WL_FUNCTION = CL_GUI_ALV_GRID=>MC_FC_CHECK.
    APPEND WL_FUNCTION TO TL_FUNCTION.
    WL_FUNCTION = CL_GUI_ALV_GRID=>MC_FC_REFRESH.
    APPEND WL_FUNCTION TO TL_FUNCTION.

    PERFORM F_MONTAR_LAYOUT USING SPACE.
    PERFORM F_MONTAR_HELP.

    CLEAR WA_LAYOUT-CWIDTH_OPT.
    GS_VARIANT_C-REPORT = SY-REPID. "Enable users save own LAYOUTs

    CALL METHOD GRID1->SET_TABLE_FOR_FIRST_DISPLAY
      EXPORTING
        IS_VARIANT           = GS_VARIANT_C
        IT_TOOLBAR_EXCLUDING = TL_FUNCTION
        IS_LAYOUT            = WA_LAYOUT
      CHANGING
        IT_FIELDCATALOG      = T_FIELDCATALOG[]
        IT_OUTTAB            = TG_ZGLT032[].

    CALL METHOD GRID1->REGISTER_EDIT_EVENT
      EXPORTING
        I_EVENT_ID = CL_GUI_ALV_GRID=>MC_EVT_MODIFIED.

    CALL METHOD GRID1->REGISTER_EDIT_EVENT
      EXPORTING
        I_EVENT_ID = CL_GUI_ALV_GRID=>MC_EVT_ENTER.


    CALL METHOD GRID1->REGISTER_F4_FOR_FIELDS
      EXPORTING
        IT_F4 = LT_F4[].

    SET HANDLER:
      LCL_EVENT_HANDLER=>ON_DOUBLE_CLICK          FOR GRID1,
      LCL_EVENT_HANDLER=>ON_DATA_CHANGED_FINISHED FOR GRID1,
      LCL_EVENT_HANDLER=>ON_DATA_CHANGED          FOR GRID1,
      LCL_EVENT_HANDLER=>ON_ONF4                  FOR GRID1.

*    posiciona spliter na altura x
    CALL METHOD SPLITTER->SET_ROW_HEIGHT
      EXPORTING
        ID     = 1
        HEIGHT = 100.
  ELSE.
    IF WG_ACAO = C_MODIF OR WG_ACAO = C_ADD.
      PERFORM F_MONTAR_LAYOUT USING C_X.
    ELSE.
      PERFORM F_MONTAR_LAYOUT USING SPACE.
    ENDIF.

    CALL METHOD GRID1->SET_FRONTEND_FIELDCATALOG
      EXPORTING
        IT_FIELDCATALOG = T_FIELDCATALOG[].

    CALL METHOD GRID1->REFRESH_TABLE_DISPLAY
      EXPORTING
        IS_STABLE = WA_STABLE.
  ENDIF.

  IF G_CUSTOM_CONT_DESC IS INITIAL.
    CREATE OBJECT G_CUSTOM_CONT_DESC
      EXPORTING
        CONTAINER_NAME = G_DESCBOX.

    IF G_CUSTOM_CONT_DESC IS NOT INITIAL.
      CREATE OBJECT OBG_DESCBOX
        EXPORTING
          PARENT            = G_CUSTOM_CONT_DESC
          WORDWRAP_MODE     = CL_GUI_TEXTEDIT=>WORDWRAP_AT_FIXED_POSITION
          WORDWRAP_POSITION = 72
          MAX_NUMBER_CHARS  = 350.

      CALL METHOD OBG_DESCBOX->SET_TOOLBAR_MODE
        EXPORTING
          TOOLBAR_MODE = '0'.

      CALL METHOD OBG_DESCBOX->SET_READONLY_MODE
        EXPORTING
          READONLY_MODE = 1.
    ENDIF.
  ENDIF.

ENDMODULE.                 " CRIA_OBJETOS  OUTPUT

*&---------------------------------------------------------------------*
*&      Module  INICIAR_TELA  OUTPUT
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
MODULE INICIAR_TELA OUTPUT.

  IF WG_ACAO IS INITIAL.
    CALL FUNCTION 'SUSR_USER_PARAMETERS_GET'
      EXPORTING
        USER_NAME           = SY-UNAME
*       WITH_TEXT           =
      TABLES
        USER_PARAMETERS     = TL_PARAMETROS
      EXCEPTIONS
        USER_NAME_NOT_EXIST = 1
        OTHERS              = 2.
    IF SY-SUBRC <> 0.
    ENDIF.

    TXT_TIPO_LANC = TEXT-L01.
    TXT_EMPRESA = TEXT-L02.
    TXT_DPTO = TEXT-L03.
    TXT_TP_DOCU = TEXT-L04.
    TXT_REF = TEXT-L05.
    TXT_CAB_DOCU = TEXT-L06.
    TXT_AP_FISCAL = TEXT-L07.
    TXT_DATA_DOCU = TEXT-L08.
    TXT_DATA_LANC = TEXT-L09.
    TXT_PROV = TEXT-L10.
    TXT_OBS = TEXT-L11.
    TXT_CONC_BANC = TEXT-L16.
    WGZGLT031-DT_DOC = TEXT-L12.
    WGZGLT031-DT_LCTO = TEXT-L12.
    WGZGLT031-DT_DOC_ULT_MES = TEXT-L13.
    WGZGLT031-DT_LCTO_ULT_MES = TEXT-L13.
    WGZGLT031-PROV_EST = TEXT-L14.
    WGZGLT031-ST_CONC_BANC = TEXT-L15.
    WGZGLT031-MOEDA_GP_HIST  = TEXT-L17.
    WGZGLT031-MOEDA_GP_HISTS = TEXT-L15.
    WGZGLT031-ST_AGRUPA  = TEXT-L18.
    WGZGLT031-ST_AGRUPAS = TEXT-L15.
    WGZGLT031-ST_TRANS_BANC = TEXT-L19.
    WGZGLT031-ST_TRANS_BANCS = TEXT-L20.
    WGZGLT031-ST_APROVA = TEXT-L21.
    WGZGLT031-ST_APROVAS = TEXT-L20.
    BTN_VISAO = TEXT-B01.
    TS_100_TAB1 = TEXT-T01.
    TS_100_TAB2 = TEXT-T02.
    BT_LOG = TEXT-B02.

    REFRESH: TG_FIELDS.
    PERFORM F_TRATA_CAMPOS USING  SPACE
                                  'GR2'
                                  C_0       "INPUT 1     NO INPUT 0
                                  C_0.      "INVISIBLE 1 VISIBLE 0

    PERFORM F_TRATA_CAMPOS USING  SPACE
                                  'GR1'
                                  C_0       "INPUT 1     NO INPUT 0
                                  C_0.      "INVISIBLE 1 VISIBLE 0
    SELECT SINGLE BNAME
      FROM USER_ADDR
      INTO VG_BNAME
      WHERE BNAME      = SY-UNAME
      AND   DEPARTMENT = 'Amaggi Holanda'.
    IF SY-SUBRC = 0.
      WG_ZGLT031-BUKRS = '0201'.
    ENDIF.
  ENDIF.
ENDMODULE.                 " INICIAR_TELA  OUTPUT

*&---------------------------------------------------------------------*
*&      Module  TRATA_FIELDS  OUTPUT
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
MODULE TRATA_FIELDS OUTPUT.
  LOOP AT TG_FIELDS.
    LOOP AT SCREEN.
      IF SCREEN-NAME EQ TG_FIELDS-CAMPO
      OR SCREEN-GROUP1 EQ TG_FIELDS-GROUP1.
        SCREEN-INPUT     = TG_FIELDS-VALUE.
        SCREEN-INVISIBLE = TG_FIELDS-INVISIBLE.
        IF SCREEN-NAME CS 'ST_APROVA'.
         READ TABLE TL_PARAMETROS INTO WL_PARAMETROS
                 WITH KEY PARID = 'ZAPR_ZGL'.
          IF SY-SUBRC NE 0.
            SCREEN-INPUT     = 0.
            SCREEN-INVISIBLE = 1.
          ENDIF.
        ENDIF.
        MODIFY SCREEN.
      ENDIF.
    ENDLOOP.
  ENDLOOP.

  IF X_FIELD IS NOT INITIAL.
    SET CURSOR FIELD X_FIELD. "'WG_DESC_OPERACAO'.
  ENDIF.
ENDMODULE.                 " TRATA_FIELDS  OUTPUT
