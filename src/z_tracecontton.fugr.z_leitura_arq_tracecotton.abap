FUNCTION Z_LEITURA_ARQ_TRACECOTTON.
*"----------------------------------------------------------------------
*"*"Interface local:
*"  IMPORTING
*"     REFERENCE(P_NOME_ARQUIVO) TYPE  STRING
*"     REFERENCE(UNIX) TYPE  CFLAG OPTIONAL
*"     REFERENCE(LOCAL) TYPE  CFLAG DEFAULT 'X'
*"  TABLES
*"      TL_ZPPT0002 STRUCTURE  ZPPT0002
*"  EXCEPTIONS
*"      FILE_OPEN_ERROR
*"      FILE_READ_ERROR
*"      NO_BATCH
*"      GUI_REFUSE_FILETRANSFER
*"      INVALID_TYPE
*"      NO_AUTHORITY
*"      UNKNOWN_ERROR
*"      BAD_DATA_FORMAT
*"      HEADER_NOT_ALLOWED
*"      SEPARATOR_NOT_ALLOWED
*"      HEADER_TOO_LONG
*"      DISK_FULL
*"      DP_TIMEOUT
*"      UNKNOWN_DP_ERROR
*"      ACCESS_DENIED
*"      DP_OUT_OF_MEMORY
*"      OUTROS
*"----------------------------------------------------------------------

  TYPES BEGIN OF TY_SPLIT.
  TYPES: VALOR TYPE CHAR50.
  TYPES END OF TY_SPLIT.

  DATA:
*         TL_ZPPT0002 TYPE TABLE OF ZPPT0002,
        WL_ZPPT0002 TYPE ZPPT0002,
        ARQUIVO     TYPE FILENAME.

  DATA: WL_SEQ      TYPE I,
        WL_SEQ1     TYPE C LENGTH 11,
        WA_ARQUIVO  TYPE ZPFE_ARQUIVO,
        LV_MSG      TYPE C LENGTH 255,
        T_ARQUIVO	  TYPE TABLE OF ZPFE_ARQUIVO WITH HEADER LINE,
        T_SPLIT     TYPE TABLE OF TY_SPLIT     WITH HEADER LINE.


  IF UNIX EQ 'X'.
*   Lê arquivo UNIX
    OPEN DATASET P_NOME_ARQUIVO FOR INPUT IN BINARY MODE.
    DO.
      READ DATASET P_NOME_ARQUIVO INTO T_ARQUIVO.
      IF SY-SUBRC IS INITIAL.
        APPEND T_ARQUIVO.
      ELSE.
        EXIT.
      ENDIF.
    ENDDO.

  ELSEIF LOCAL EQ 'X'.
*   Lê arquivo WINDOWS
    CALL FUNCTION 'GUI_UPLOAD'
      EXPORTING
        FILENAME                = P_NOME_ARQUIVO
        FILETYPE                = 'ASC'
      TABLES
        DATA_TAB                = T_ARQUIVO
      EXCEPTIONS
        FILE_OPEN_ERROR         = 1
        FILE_READ_ERROR         = 2
        NO_BATCH                = 3
        GUI_REFUSE_FILETRANSFER = 4
        INVALID_TYPE            = 5
        NO_AUTHORITY            = 6
        UNKNOWN_ERROR           = 7
        BAD_DATA_FORMAT         = 8
        HEADER_NOT_ALLOWED      = 9
        SEPARATOR_NOT_ALLOWED   = 10
        HEADER_TOO_LONG         = 11
        UNKNOWN_DP_ERROR        = 12
        ACCESS_DENIED           = 13
        DP_OUT_OF_MEMORY        = 14
        DISK_FULL               = 15
        DP_TIMEOUT              = 16
        OTHERS                  = 17.

    CASE SY-SUBRC.
      WHEN 01.
        RAISE FILE_OPEN_ERROR.
      WHEN 02.
        RAISE FILE_READ_ERROR.
      WHEN 03.
        RAISE NO_BATCH.
      WHEN 04.
        RAISE GUI_REFUSE_FILETRANSFER.
      WHEN 05.
        RAISE INVALID_TYPE.
      WHEN 06.
        RAISE NO_AUTHORITY.
      WHEN 07.
        RAISE UNKNOWN_ERROR.
      WHEN 08.
        RAISE BAD_DATA_FORMAT.
      WHEN 09.
        RAISE HEADER_NOT_ALLOWED.
      WHEN 10.
        RAISE SEPARATOR_NOT_ALLOWED.
      WHEN 11.
        RAISE HEADER_TOO_LONG.
      WHEN 12.
        RAISE UNKNOWN_DP_ERROR.
      WHEN 13.
        RAISE ACCESS_DENIED.
      WHEN 14.
        RAISE DP_OUT_OF_MEMORY.
      WHEN 15.
        RAISE DISK_FULL.
      WHEN 16.
        RAISE DP_TIMEOUT.
      WHEN 17.
        MESSAGE ID SY-MSGID TYPE SY-MSGTY NUMBER SY-MSGNO
              WITH SY-MSGV1 SY-MSGV2 SY-MSGV3 SY-MSGV4 RAISING OUTROS.

    ENDCASE.
  ENDIF.

  LOOP AT T_ARQUIVO.
   CLEAR: T_SPLIT[].
   SPLIT T_ARQUIVO-LINHA AT ';' INTO TABLE T_SPLIT.
    LOOP AT T_SPLIT.
      CASE SY-TABIX.
        WHEN 1.
          "1) MANDT   MANDANTE;
          MOVE:T_SPLIT-VALOR TO WL_ZPPT0002-MANDT.
        WHEN 2.
          "2)	WERKS  FAZENDA ORIGEM DO FARDINHO;
          MOVE:T_SPLIT-VALOR TO WL_ZPPT0002-WERKS.
        WHEN 3.
          "3)	USNAM  CRIADOR;
          MOVE:T_SPLIT-VALOR TO WL_ZPPT0002-USNAM.

        WHEN 4.
          "4)	BUDAT  DATA DE LANCAMENTO DO DOCUMENTO;
*    CONCATENATE WL_ZPPT0002-BUDAT+6(2) '.' WL_ZPPT0002-BUDAT+6(2) '.'  WL_ZPPT0002-BUDAT(4) INTO WL_ZPPT0002-BUDAT SEPARATED BY SPACE.
          MOVE T_SPLIT-VALOR TO WL_ZPPT0002-BUDAT.

        WHEN 5.
          "5)BLDAT  DATA;
          MOVE T_SPLIT-VALOR TO WL_ZPPT0002-BLDAT.

        WHEN 6.
          "6)	DT_FABRICAÇÃO DATA E HORA QUE FOI PRODUZIDO;
          MOVE T_SPLIT-VALOR TO WL_ZPPT0002-DT_FABRICACAO.

        WHEN 7.
          "7) CD_SAFRA;
          MOVE T_SPLIT-VALOR TO WL_ZPPT0002-CD_SAFRA.

        WHEN 8.
          "8) MATNR CODIGO DE MATERIAL EM PLUMA;
          MOVE T_SPLIT-VALOR TO WL_ZPPT0002-MATNR.

        WHEN 9.
          "9) VERID NUMERO DA VERSÃO;
          MOVE T_SPLIT-VALOR TO WL_ZPPT0002-VERID.

        WHEN 10.
          "10) ID_FARDINHO CHAVE DO TRACECOTTON;
          MOVE T_SPLIT-VALOR TO WL_ZPPT0002-ID_FARDINHO.

        WHEN 11.
          "11) ACHARG  NR_LOTE FARDINHO (XX/ZAAAAAA);
          MOVE T_SPLIT-VALOR TO WL_ZPPT0002-ACHARG.


        WHEN 12.
          "12) CD_SAI CODIGO SAI;
          MOVE T_SPLIT-VALOR TO WL_ZPPT0002-CD_SAI.


        WHEN 13.
          "13) MENGE    PESO LIQUIDO DO FARDINHO COM 1 CASA DECIMAL;
          MOVE T_SPLIT-VALOR TO WL_ZPPT0002-MENGE.


        WHEN 14.
          "14) PESO_BRUTO   PESO BRUTO DO FARDINHO COM 1 CASA DECIMAL;
          MOVE T_SPLIT-VALOR TO WL_ZPPT0002-PESO_BRUTO.

        WHEN 15.
          "15) CHARG   CODIGO DO FARDAO DE ORIGEM;
          MOVE T_SPLIT-VALOR TO WL_ZPPT0002-CHARG.

        WHEN 16.
          "16) ID_FARDÃO   CHAVE DO FARDAO NO TRACECOTTON;
          MOVE T_SPLIT-VALOR TO WL_ZPPT0002-ID_FARDAO.

        WHEN 17.
          "17) CD_CLASSIFICAÇÃO   CODIGO DE CLASSIFICACAO DE ALGODAO EM PLUMA;
          MOVE T_SPLIT-VALOR TO WL_ZPPT0002-CD_CLASSIFICACAO.

        WHEN 18.
          "18) LGORT   NUMERO DO BLOCO/LOTE DE VENDA DO FARDINHO;
          MOVE T_SPLIT-VALOR TO WL_ZPPT0002-LGORT.

        WHEN 19.
          "19)  MBLNR  NUMERO DE DOCUMENTO DE MATERIAL DE ENTRADA SAP;
          MOVE T_SPLIT-VALOR TO WL_ZPPT0002-MBLNR.

        WHEN 20.
          "20) ERNAM  ULTIMO MODIFICADOR;
          MOVE T_SPLIT-VALOR TO WL_ZPPT0002-ERNAM.

        WHEN 21.
          "21) LAEDA  DATA ULTIMA ATUALIZAÇÃO DO REGISTRO;
          MOVE T_SPLIT-VALOR TO WL_ZPPT0002-LAEDA.

        WHEN 22.
          "22) STATUS_REGISTRO  CODIGO DE STATUS DO REGISTRO;
          MOVE T_SPLIT-VALOR TO WL_ZPPT0002-STATUS_REGISTRO.

        WHEN 23.
          "23) CD_MENSAGEM   CODIGO DE MENSAGEM DETALHADO;
          MOVE T_SPLIT-VALOR TO WL_ZPPT0002-CD_MENSAGEM.

      ENDCASE.
    ENDLOOP.
    APPEND WL_ZPPT0002 TO TL_ZPPT0002.
    CLEAR: WL_ZPPT0002.
  ENDLOOP.

ENDFUNCTION.
