*&---------------------------------------------------------------------*
*& Report  ZFIY0036
*&
*&---------------------------------------------------------------------*
*&
*&
*&---------------------------------------------------------------------*
REPORT ZFIY0036.

TABLES: LFBW, LFB1.


DATA: IT_LFB1     TYPE TABLE OF LFB1,
      WA_LFB1     TYPE LFB1,
      IT_LFBW     TYPE TABLE OF LFBW,
      WA_LFBW     TYPE LFBW,
      IT_INCLUSAO TYPE TABLE OF LFBW,
      WA_INCLUSAO TYPE LFBW.



SELECTION-SCREEN BEGIN OF BLOCK B1 WITH FRAME TITLE TEXT-001.
SELECT-OPTIONS: S_SOCIE       FOR LFBW-BUKRS     NO INTERVALS NO-EXTENSION OBLIGATORY DEFAULT '0100',
                S_ACREED      FOR LFB1-LIFNR,
                S_WITHT       FOR LFBW-WITHT     NO-EXTENSION NO INTERVALS OBLIGATORY,
                S_WITHCD      FOR LFBW-WT_WITHCD NO-EXTENSION NO INTERVALS OBLIGATORY.
SELECTION-SCREEN END OF BLOCK B1.

SELECTION-SCREEN BEGIN OF BLOCK B2 WITH FRAME TITLE TEXT-002.
PARAMETERS: S_INC RADIOBUTTON GROUP GB1,
            S_EXC RADIOBUTTON GROUP GB1.
SELECTION-SCREEN END OF BLOCK B2.



INITIALIZATION.


START-OF-SELECTION.


  IF S_ACREED IS NOT INITIAL.

    SELECT * FROM LFB1 INTO TABLE IT_LFB1
      WHERE LIFNR IN S_ACREED.
  ELSE.

    SELECT * FROM LFB1 INTO TABLE IT_LFB1
      WHERE BUKRS IN S_SOCIE.
  ENDIF.

  IF S_INC IS NOT INITIAL.

    LOOP AT IT_LFB1 INTO WA_LFB1.

      WA_INCLUSAO-MANDT       = SY-MANDT.
      WA_INCLUSAO-LIFNR       = WA_LFB1-LIFNR.
      WA_INCLUSAO-BUKRS       = S_SOCIE-LOW.
      WA_INCLUSAO-WITHT       = S_WITHT-LOW.
      WA_INCLUSAO-WT_SUBJCT   = 'X'.
      WA_INCLUSAO-WT_WITHCD   = S_WITHCD-LOW.

      APPEND WA_INCLUSAO TO IT_INCLUSAO.
      CLEAR: WA_LFB1, WA_INCLUSAO.
    ENDLOOP.

    MODIFY  LFBW FROM TABLE IT_INCLUSAO.
    REFRESH: IT_INCLUSAO, IT_LFB1.
    MESSAGE 'Inclusão realizada com sucesso!' TYPE 'S'.

  ENDIF.



  IF S_EXC IS NOT INITIAL.

    SELECT * FROM LFBW  INTO TABLE IT_LFBW
      FOR ALL ENTRIES IN IT_LFB1
      WHERE LIFNR     EQ IT_LFB1-LIFNR
       AND  BUKRS     IN S_SOCIE
       AND  WITHT     IN S_WITHT
       AND  WT_WITHCD IN S_WITHCD.

    LOOP AT IT_LFBW INTO WA_LFBW.

      DELETE FROM LFBW WHERE LIFNR      =  WA_LFBW-LIFNR    AND
                             BUKRS      =  WA_LFBW-BUKRS    AND
                             WITHT      =  WA_LFBW-WITHT    AND
                             WT_WITHCD  =  WA_LFBW-WT_WITHCD.
      CLEAR WA_LFBW.
    ENDLOOP.

    REFRESH: IT_LFBW, IT_LFB1.
    MESSAGE 'Exclusão realizada com sucesso!' TYPE 'S'.

  ENDIF.
