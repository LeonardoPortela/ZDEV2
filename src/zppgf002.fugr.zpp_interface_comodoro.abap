FUNCTION ZPP_INTERFACE_COMODORO.
*"----------------------------------------------------------------------
*"*"Interface local:
*"  IMPORTING
*"     REFERENCE(ORDEM_CARREGAMENTO) TYPE  ZPPED003
*"  EXPORTING
*"     REFERENCE(RETURN) TYPE  STRING
*"----------------------------------------------------------------------

  DATA(OBJ_SER) = NEW ZCL_PP_SERVICES( ).
  DATA(SERVICE_CX) = NEW ZCX_PP_SERVICES( ).
*  DATA MSG TYPE BAPIRET2.

  IF ORDEM_CARREGAMENTO IS INITIAL.
    RETURN = 'Ã‰ obrigatorio o preenchimento da Ordem de Carregamento!'.
    EXIT.
  ENDIF.

  CALL METHOD OBJ_SER->SELECT_SHIPMENT
    EXPORTING
      ORDEM_CARREGAMENTO = ORDEM_CARREGAMENTO
    EXCEPTIONS
      SHIPMENT_NOT_FOUND = 4.

  TRY.
      CALL METHOD OBJ_SER->PROCESS_ORDER_IS_LOCKED( OBJ_SER->GET_SHIPMENT( )-AUFNR ).
      CALL METHOD OBJ_SER->STORNO_PROCESS_ORDER( ORDEM_CARREGAMENTO = ORDEM_CARREGAMENTO ).

    CATCH ZCX_PP_SERVICES INTO SERVICE_CX.

*      CALL FUNCTION 'BALW_BAPIRETURN_GET2'
*        EXPORTING
*          TYPE   = SY-MSGTY
*          CL     = SERVICE_CX->IF_T100_MESSAGE~T100KEY-MSGID
*          NUMBER = SERVICE_CX->IF_T100_MESSAGE~T100KEY-MSGNO
*          PAR1   = SERVICE_CX->IF_T100_MESSAGE~T100KEY-ATTR1
*          PAR2   = SERVICE_CX->IF_T100_MESSAGE~T100KEY-ATTR2
*          PAR3   = SERVICE_CX->IF_T100_MESSAGE~T100KEY-ATTR3
*          PAR4   = SERVICE_CX->IF_T100_MESSAGE~T100KEY-ATTR4
*        IMPORTING
*          RETURN = MSG.

  ENDTRY.

  CALL METHOD OBJ_SER->CHANGE_PO_USER_STATUS( ORDER = OBJ_SER->GET_SHIPMENT( )-AUFNR STATUS = 'PSVA' ). "//Pesagem Vazio

  DATA(_ORDERS) = VALUE TB_BAPI_ORDER_KEY( ( ORDER_NUMBER = OBJ_SER->GET_SHIPMENT( )-AUFNR ) ).

  CALL FUNCTION 'BAPI_PROCORD_SET_DELETION_FLAG'
    EXPORTING
      WORK_PROCESS_GROUP = 'COWORK_BAPI'
      WORK_PROCESS_MAX   = 99
    TABLES
      ORDERS             = _ORDERS.


  CHECK ( OBJ_SER->HAS_MESSAGES( ) = ABAP_TRUE ).

ENDFUNCTION.
