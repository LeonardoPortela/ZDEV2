FUNCTION Z_MEMO_AGRUPA_NOTAS_MEMORANDO.
*"----------------------------------------------------------------------
*"*"Interface local:
*"  IMPORTING
*"     REFERENCE(P_NR_MEMORANDO) TYPE  Z_MEMORANDO OPTIONAL
*"     REFERENCE(STATUS) TYPE  CHAR1 OPTIONAL
*"     REFERENCE(LAYOUT_NEW) TYPE  CHAR1 OPTIONAL
*"     REFERENCE(DIRECAO) TYPE  Z_MEMO_DIRECAO OPTIONAL
*"  TABLES
*"      IT_NOTAS STRUCTURE  ZDOC_MEMO_NOTAS
*"      IT_NF_NOTAS STRUCTURE  ZDOC_MEMO_NOTA OPTIONAL
*"----------------------------------------------------------------------
  DATA: TABELA TYPE STRING VALUE 'ZDOC_MEMO_NOTA'.

  CHECK IT_NF_NOTAS[] IS INITIAL.

  TABELA = COND #( WHEN STATUS IS NOT INITIAL
                           THEN |{ TABELA }_C|
                           ELSE COND #( WHEN DIRECAO EQ C_2
                                                THEN |{ TABELA }_S|
                                                ELSE TABELA ) ).

  SELECT *
    INTO CORRESPONDING FIELDS OF TABLE IT_NF_NOTAS
    FROM (TABELA)
   WHERE NR_MEMORANDO EQ P_NR_MEMORANDO
    ORDER BY NR_MEMORANDO MODEL DOCDAT NFENUM NFNUM.

  CHECK NOT IT_NF_NOTAS[] IS INITIAL.

  IF NOT LAYOUT_NEW IS INITIAL.
    PERFORM ADD_NOTA_NEW TABLES IT_NF_NOTAS IT_NOTAS.
  ELSE.
    PERFORM ADD_NOTA TABLES IT_NF_NOTAS IT_NOTAS.
  ENDIF.

ENDFUNCTION.
