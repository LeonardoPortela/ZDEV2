FUNCTION ZAA_MOV_MENSAL_SALDO_ACML_BPC.
*"----------------------------------------------------------------------
*"*"Interface local:
*"  TABLES
*"      T_MOV_MENSAL_SLD_ACML STRUCTURE  ZMOV_MENSAL_SLD_ACML_BPC
*"      T_RET_MOV_MENSAL_SLD_ACML STRUCTURE  ZRET_MOV_MENSAL_SLD_ACML
*"----------------------------------------------------------------------
  IT_MOV_MENSAL_SLD_ACML[]    = T_MOV_MENSAL_SLD_ACML[].

  DATA: YEAR(4)        TYPE C,
        YEARINI(4)     TYPE C,
        YEARFIM(4)     TYPE C.



  CLEAR: WA_MOV_MENSAL_SLD_ACML,
         WA_RET_MOV_MENSAL_SLD_ACML_AUX,
         P_BUKRS,
         P_GJAHR,
         P_GJAHR_ANT,
         P_MONAT,
         P_SAKNR,
         IT_ZCOT0008,
         WA_ZCOT0008,
         WA_RET_MOV_MENSAL_SLD_ACML,
         YEAR.


  YEAR = SY-DATUM(4) . "Pega o ano corrente.

*  LOOP AT IT_MOV_MENSAL_SLD_ACML INTO WA_MOV_MENSAL_SLD_ACML.
*    IF WA_MOV_MENSAL_SLD_ACML-CAMPO EQ 'BUKRS'.
*      P_BUKRS-LOW    = WA_MOV_MENSAL_SLD_ACML-VALOR_DE.
*      P_BUKRS-HIGH   = WA_MOV_MENSAL_SLD_ACML-VALOR_ATE.
*      P_BUKRS-SIGN   = WA_MOV_MENSAL_SLD_ACML-SIGN.
*      P_BUKRS-OPTION = WA_MOV_MENSAL_SLD_ACML-OPTION.
*      APPEND P_BUKRS.
*    ENDIF.
*
*    IF WA_MOV_MENSAL_SLD_ACML-CAMPO EQ 'GJAHR'.


*      YEARINI  = WA_MOV_MENSAL_SLD_ACML-VALOR_DE.
*      YEARFIM  = WA_MOV_MENSAL_SLD_ACML-VALOR_ATE.
*
*      IF YEARINI < YEAR.
*
*        P_GJAHR_ANT-LOW    = YEARINI.
*
*        IF YEARFIM < YEAR.
*          P_GJAHR_ANT-HIGH   = YEARFIM.
*        ELSE.
*          P_GJAHR_ANT-HIGH   = YEAR - 1 .
*        ENDIF.
*
*        P_GJAHR_ANT-SIGN   = WA_MOV_MENSAL_SLD_ACML-SIGN.
*        P_GJAHR_ANT-OPTION = WA_MOV_MENSAL_SLD_ACML-OPTION.
*        APPEND P_GJAHR_ANT.
*
*      ENDIF.
*
*      IF YEARFIM >= YEAR.
*        P_GJAHR-LOW    = YEAR.
*        P_GJAHR-HIGH   = YEARFIM.
*        P_GJAHR-SIGN   = WA_MOV_MENSAL_SLD_ACML-SIGN.
*        P_GJAHR-OPTION = WA_MOV_MENSAL_SLD_ACML-OPTION.
*        APPEND P_GJAHR.
*      ENDIF.

*    ENDIF.
*    IF WA_MOV_MENSAL_SLD_ACML-CAMPO EQ 'MONAT'.
*      P_MONAT-LOW    = WA_MOV_MENSAL_SLD_ACML-VALOR_DE.
*      P_MONAT-HIGH   = WA_MOV_MENSAL_SLD_ACML-VALOR_ATE.
*      P_MONAT-SIGN   = WA_MOV_MENSAL_SLD_ACML-SIGN.
*      P_MONAT-OPTION = WA_MOV_MENSAL_SLD_ACML-OPTION.
*      APPEND P_MONAT.
*    ENDIF.
*
*    IF WA_MOV_MENSAL_SLD_ACML-CAMPO EQ 'SAKNR'.
*      P_SAKNR-LOW    = WA_MOV_MENSAL_SLD_ACML-VALOR_DE.
*      P_SAKNR-HIGH   = WA_MOV_MENSAL_SLD_ACML-VALOR_ATE.
*      P_SAKNR-SIGN   = WA_MOV_MENSAL_SLD_ACML-SIGN.
*      P_SAKNR-OPTION = WA_MOV_MENSAL_SLD_ACML-OPTION.
*      APPEND P_SAKNR.
*    ENDIF.
*
*  ENDLOOP.


*  " Verifica se ja existe dados na ZCOT0008
*  " NÃ£o faz a carga de 2012 devido a ajustes iniciais que foram feitos na tabela.
*  " Verifica se ja existe dados na tabela.
*
*
*
*  IF P_GJAHR_ANT IS NOT INITIAL.
*
*    SELECT *
*      INTO TABLE IT_ZCOT0008
*      FROM ZCOT0008
*     WHERE EMPRESA       IN P_BUKRS
*       AND EXERCICIO     IN P_GJAHR_ANT
*       AND MES_EXERCICIO IN P_MONAT .
*
*
*    IF IT_ZCOT0008 IS NOT INITIAL.
*
*
*      LOOP AT IT_ZCOT0008 INTO WA_ZCOT0008.
*
*        WA_RET_MOV_MENSAL_SLD_ACML-EMPRESA               = WA_ZCOT0008-EMPRESA.
*        WA_RET_MOV_MENSAL_SLD_ACML-EXERCICIO             = WA_ZCOT0008-EXERCICIO.
*        WA_RET_MOV_MENSAL_SLD_ACML-MES_EXERCICIO         = WA_ZCOT0008-MES_EXERCICIO.
*        WA_RET_MOV_MENSAL_SLD_ACML-CONTA_RAZAO           = WA_ZCOT0008-CONTA_RAZAO.
*        WA_RET_MOV_MENSAL_SLD_ACML-SOCIEDADE_PARCEIRA    = WA_ZCOT0008-SOCIEDADE_PARCEI.
*        WA_RET_MOV_MENSAL_SLD_ACML-CENTRO_CUSTO          = WA_ZCOT0008-CENTRO_CUSTO.
*        WA_RET_MOV_MENSAL_SLD_ACML-GRUPO_MERCADORIA      = WA_ZCOT0008-GRUPO_MERCADORIA.
*        WA_RET_MOV_MENSAL_SLD_ACML-MOEDA                 = WA_ZCOT0008-MOEDA.
*        WA_RET_MOV_MENSAL_SLD_ACML-MATERIAL              = WA_ZCOT0008-MATERIAL.
*        WA_RET_MOV_MENSAL_SLD_ACML-MOVIMENTACAO_MENSAL   = WA_ZCOT0008-MOVIMENTACAO_MEN.
*        WA_RET_MOV_MENSAL_SLD_ACML-SLD_ACL_MES           = WA_ZCOT0008-SLD_ACL_MES.
*        WA_RET_MOV_MENSAL_SLD_ACML-AREA_CONT_CUST        = WA_ZCOT0008-AREA_CONT_CUST.
*
*        APPEND WA_RET_MOV_MENSAL_SLD_ACML TO IT_RET_MOV_MENSAL_SLD_ACML.
*
*      ENDLOOP.
*    ENDIF.
*  ENDIF.
*
*  T_RET_MOV_MENSAL_SLD_ACML[] = IT_RET_MOV_MENSAL_SLD_ACML[].
*
*  CLEAR:  IT_RET_MOV_MENSAL_SLD_ACML[],
*          IT_ZCOT0008,
*          WA_ZCOT0008.

*  IF P_GJAHR IS NOT INITIAL.

    PERFORM : ZSELECIONA_DADOS_MOV_SLD_ACML,
              ZPROCESSA_RETORNO_MOV_SLD_ACML .


*    IF IT_RET_MOV_MENSAL_SLD_ACML[] IS NOT INITIAL.
*
*      LOOP AT  IT_RET_MOV_MENSAL_SLD_ACML INTO WA_RET_MOV_MENSAL_SLD_ACML_AUX.
*
*        WA_RET_MOV_MENSAL_SLD_ACML-EMPRESA             =  WA_RET_MOV_MENSAL_SLD_ACML_AUX-EMPRESA.
*        WA_RET_MOV_MENSAL_SLD_ACML-EXERCICIO           =  WA_RET_MOV_MENSAL_SLD_ACML_AUX-EXERCICIO.
*        WA_RET_MOV_MENSAL_SLD_ACML-MES_EXERCICIO       =  WA_RET_MOV_MENSAL_SLD_ACML_AUX-MES_EXERCICIO.
*        WA_RET_MOV_MENSAL_SLD_ACML-CONTA_RAZAO         =  WA_RET_MOV_MENSAL_SLD_ACML_AUX-CONTA_RAZAO.
*        WA_RET_MOV_MENSAL_SLD_ACML-SOCIEDADE_PARCEIRA  =  WA_RET_MOV_MENSAL_SLD_ACML_AUX-SOCIEDADE_PARCEIRA .
*        WA_RET_MOV_MENSAL_SLD_ACML-CENTRO_CUSTO        =  WA_RET_MOV_MENSAL_SLD_ACML_AUX-CENTRO_CUSTO.
*        WA_RET_MOV_MENSAL_SLD_ACML-GRUPO_MERCADORIA    =  WA_RET_MOV_MENSAL_SLD_ACML_AUX-GRUPO_MERCADORIA .
*        WA_RET_MOV_MENSAL_SLD_ACML-MOEDA               =  WA_RET_MOV_MENSAL_SLD_ACML_AUX-MOEDA    .
*        WA_RET_MOV_MENSAL_SLD_ACML-MATERIAL            =  WA_RET_MOV_MENSAL_SLD_ACML_AUX-MATERIAL .
*        WA_RET_MOV_MENSAL_SLD_ACML-MOVIMENTACAO_MENSAL =  WA_RET_MOV_MENSAL_SLD_ACML_AUX-MOVIMENTACAO_MENSAL.
*        WA_RET_MOV_MENSAL_SLD_ACML-SLD_ACL_MES         =  WA_RET_MOV_MENSAL_SLD_ACML_AUX-SLD_ACL_MES .
*        WA_RET_MOV_MENSAL_SLD_ACML-AREA_CONT_CUST      =  WA_RET_MOV_MENSAL_SLD_ACML_AUX-AREA_CONT_CUST.
*
*        APPEND WA_RET_MOV_MENSAL_SLD_ACML TO T_RET_MOV_MENSAL_SLD_ACML.
*
*      ENDLOOP.
*    ENDIF.
*  ENDIF.

" cometar depois
  T_RET_MOV_MENSAL_SLD_ACML[] = IT_RET_MOV_MENSAL_SLD_ACML[].

  "MODIFY ZCOT0008 FROM TABLE IT_ZCOT0008.
  "COMMIT WORK.

ENDFUNCTION.
