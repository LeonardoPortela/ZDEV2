*&---------------------------------------------------------------------*
*&  Include           ZFIAA02_TOP
*&---------------------------------------------------------------------*

REPORT ZFIAA02.

TABLES: ANLA, ANLZ, ZAA002,ZAA001,
        ZAA003, ICON.

TYPES: BEGIN OF TY_MENU_TREE,
         NODE_PAI         TYPE CHAR50,
         NODE_FILHO       TYPE CHAR50,
         NODE_IMAGE_PAI   TYPE TV_IMAGE,
         NODE_IMAGE_FILHO TYPE TV_IMAGE,
       END OF TY_MENU_TREE.

TYPES: BEGIN OF TY_SAIDA_0110,
         CHECK(1)    TYPE C,
         DT_INCOR    TYPE ANLA-AKTIV,
         DT_DESAT    TYPE ANLA-DEAKT,
         ANLN1       TYPE ANLA-ANLN1,
         ANLN2       TYPE ANLA-ANLN2,
         BUKRS       TYPE ANLA-BUKRS,
         FILIAL      TYPE ANLZ-WERKS,
         KFZKZ       TYPE ANLZ-KFZKZ,
         CENTRO      TYPE ANLZ-KOSTL,
         NR_CHASSI   TYPE ANLA-INVNR,
         DENOM1      TYPE ANLA-TXT50,
         DENOM2      TYPE ANLZ-ANLN1,
         TXT_PRINC   TYPE ANLA-MCOA1,
         PORTE_OBRIG TYPE ZAA001-PORTE_OBRIG,    "CS2019001264 28.05.2020
         PAIS        TYPE ZAA001-COD_PAIS,
         REGIAO      TYPE ZAA001-COD_REGI,
         ANO_FABR    TYPE ZAA001-ANO_FABR,
         ANO_MOD     TYPE ZAA001-ANO_MODE,
         POTENCIA    TYPE ZAA001-POTENCIA,
         COR         TYPE ZAA001-COR,
         PG_ARQ      TYPE ZAA001-PG_ARQ,
         RESP_VEIC   TYPE ZAA001-RESP_VEIC,
         COD_RENAVAN TYPE ZAA001-COD_REGISTRO,
         MES_IPVA    TYPE ZAA001-MES_IPVA,
         MES_LICENC  TYPE ZAA001-MES_LICENC,
         MES_DPVAT   TYPE ZAA001-MES_DPVAT,
         DT_CRIACAO  TYPE ZAA001-DT_CRIACAO,
         HR_CRIACAO  TYPE ZAA001-HR_CRIACAO,
         USER_CRIAC  TYPE ZAA001-USER_CRIACAO,
         DT_MODIF    TYPE ZAA001-DT_MODIF,
         USER_MODIF  TYPE ZAA001-USER_MODIF,
         OBSERVACAO  TYPE ZAA001-OBSERVACAO,

       END OF TY_SAIDA_0110,

       BEGIN OF TY_SAIDA_0140,
         STATUS       TYPE ICON-ID,
         CHECK(1)     TYPE C,
         KFZKZ        TYPE KFZKZ,
         BUKRS        TYPE ANLA-BUKRS,
         WERKS        TYPE ANLZ-WERKS,
         ANLN1        TYPE ANLA-ANLN1,
         ANLN2        TYPE ANLA-ANLN2,
         TXT50        TYPE ANLA-TXT50,
         MES_VCTO     TYPE ZAA002-MES_VCTO,
         COD_REGI     TYPE REGIO,
         COD_REGISTRO TYPE ZCD_RENAVAM,
         TP_OBRIG     TYPE CHAR20,
         ANO_VCTO     TYPE NUM4,
         DT_VENC      TYPE ZAA003-DT_VENC,
         DEP_RESP     TYPE CHAR2 ,
         COD_IMPOSTO  TYPE ZCOD_IMPOSTO,
         WAERS        TYPE WAERS,
         KOSTL        TYPE KOSTL,
         LIFNR        TYPE LIFNR,
         VLR_PRINC    TYPE DMBTR,
         VLR_CORRE    TYPE DMBTR,
         VLR_MULTA    TYPE DMBTR,
         VLR_JUROS    TYPE DMBTR,
         VLR_TSE      TYPE DMBTR,
         VLR_TOTAL    TYPE DMBTR,
         CONV_BANC    TYPE C,
         COD_BARRAS   TYPE ZCOD_BARRAS,
         ESTILO       TYPE LVC_T_STYL,
         ERDAT        TYPE ERDAT,
         ERNAM        TYPE ERNAM,
         LOTE         TYPE ZLOTE_IMP,
         DOC_CONTABIL TYPE ZIB_CONTABIL_CHV-BELNR,
         DOC_IMPOSTO  TYPE ZDOC_IMPOSTO,
         FILIAL_PG    TYPE ANLZ-WERKS,
         KOSTL_PG     TYPE ZIMP_LANC_IMP_CT-KOSTL,
       END OF TY_SAIDA_0140,

       BEGIN OF TY_SAIDA_0170,

         DT_INCOR    TYPE ANLA-AKTIV,
         DT_DESAT    TYPE ANLA-DEAKT,
         ANLN1       TYPE ANLA-ANLN1,
         ANLN2       TYPE ANLA-ANLN2,
         BUKRS       TYPE ANLA-BUKRS,
         FILIAL      TYPE ANLZ-WERKS,
         KFZKZ       TYPE ANLZ-KFZKZ,
         CENTRO      TYPE ANLZ-KOSTL,
         NR_CHASSI   TYPE ANLA-INVNR,
         DENOM1      TYPE ANLA-TXT50,
         DENOM2      TYPE ANLZ-ANLN1,
*         TXT_PRINC   TYPE ANLA-MCOA1,       "CS2019001264 28.05.2020
         TXT_PRINC   TYPE CHAR100,
         PAIS        TYPE ZAA001-COD_PAIS,
         REGIAO      TYPE ZAA001-COD_REGI,
         ANO_FABR    TYPE ZAA001-ANO_FABR,
         ANO_MOD     TYPE ZAA001-ANO_MODE,
         POTENCIA    TYPE ZAA001-POTENCIA,
         COR         TYPE ZAA001-COR,
         PG_ARQ      TYPE ZAA001-PG_ARQ,
         RESP_VEIC   TYPE ZAA001-RESP_VEIC,
         COD_RENAVAN TYPE ZAA001-COD_REGISTRO,
         MES_IPVA    TYPE ZAA001-MES_IPVA,
         MES_LICENC  TYPE ZAA001-MES_LICENC,
         MES_DPVAT   TYPE ZAA001-MES_DPVAT,
         DT_CRIACAO  TYPE ZAA001-DT_CRIACAO,
         HR_CRIACAO  TYPE ZAA001-HR_CRIACAO,
         USER_CRIAC  TYPE ZAA001-USER_CRIACAO,
         DT_MODIF    TYPE ZAA001-DT_MODIF,
         USER_MODIF  TYPE ZAA001-USER_MODIF,
         OBS         TYPE ZAA001-OBSERVACAO,
         DUT         TYPE ZAA001-DUT,
         ALIENACAO   TYPE ZAA001-ALIENACAO,
         PORTE_OBRIG TYPE ZAA001-PORTE_OBRIG,
       END OF TY_SAIDA_0170,

       BEGIN OF TY_SAIDA_0180,
         BUKRS       TYPE ZAA003-BUKRS,
         ANLN1       TYPE ZAA003-ANLN1,
         ANLN2       TYPE ZAA003-ANLN2,
         KFZKZ       TYPE ZAA003-KFZKZ,
         WERKS       TYPE ZAA003-WERKS,
         TP_OBRIG    TYPE ZAA003-TP_OBRIG,
         ANO_VCTO    TYPE ZAA003-ANO_VCTO,
         MES_VCTO    TYPE ZAA003-MES_VCTO,
         WAERS       TYPE ZAA003-WAERS,
         VLR_PRINC   TYPE ZAA003-VLR_PRINC,
         VLR_CORRE   TYPE ZAA003-VLR_CORRE,
         VLR_MULTA   TYPE ZAA003-VLR_MULTA,
         VLR_JUROS   TYPE ZAA003-VLR_JUROS,
         VLR_TSE     TYPE ZAA003-VLR_TSE,
         VLR_TOTAL   TYPE ZAA003-VLR_TOTAL,
         COD_BARRAS  TYPE ZAA003-COD_BARRAS,
         DT_VENC     TYPE ZAA003-DT_VENC,
         DEP_RESP    TYPE ZAA003-DEP_RESP,
         ERDAT       TYPE ZAA003-ERDAT,
         ERNAM       TYPE ZAA003-ERNAM,
         LOTE        TYPE ZAA003-LOTE,
         COD_IMPOSTO TYPE ZAA003-COD_IMPOSTO,
         DOC_IMPOSTO TYPE ZAA003-DOC_IMPOSTO,
       END OF TY_SAIDA_0180,

       BEGIN OF TY_SAIDA_0300,
         STATUS       TYPE ICON-ID,
         MSG_ERRO     TYPE CHAR200,
         DOC_CONTABIL TYPE ZIB_CONTABIL_CHV-BELNR,
         INDEX_ERRO   TYPE SY-TABIX,
       END OF TY_SAIDA_0300,

       BEGIN OF TY_HEADER_0110,
         EMPRESA TYPE TEXT30,
         FILIAL  TYPE TEXT30,
         CENTRO  TYPE TEXT30,
       END OF TY_HEADER_0110,

       BEGIN OF TY_FIELDS,
         FIELDNAME TYPE LVC_FNAME,
         GROUP1    TYPE CHAR3,
         GROUP2    TYPE CHAR3,
         VALUE     TYPE CHAR1,
         INVISIBLE TYPE CHAR1,
       END OF TY_FIELDS,

       BEGIN OF TY_FIELDS_STYLE,
         FIELDNAME TYPE LVC_FNAME,
       END OF TY_FIELDS_STYLE,

*BEGIN OF ty_fields_disable,
*fieldname type LVC_FNAME,
*END OF ty_fields_

       BEGIN OF TY_EDITOR,
         LINE(200),
       END OF TY_EDITOR.

*     Objetos de referência
DATA: OBJ_CUSTOM_TREE     TYPE REF TO CL_GUI_CUSTOM_CONTAINER,
      OBJ_ALV_TREE        TYPE REF TO CL_GUI_ALV_TREE,
      OBJ_DOCKING         TYPE REF TO CL_GUI_DOCKING_CONTAINER,
      OBJ_CUSTOM_0110     TYPE REF TO CL_GUI_CUSTOM_CONTAINER,
      OBJ_CUSTOM_0300     TYPE REF TO CL_GUI_CUSTOM_CONTAINER,
      OBJ_ALV_0110        TYPE REF TO CL_GUI_ALV_GRID,
      OBJ_ALV_0300        TYPE REF TO CL_GUI_ALV_GRID,
      OBJ_CUSTOM_TXT      TYPE REF TO CL_GUI_CUSTOM_CONTAINER,
      OBJ_CUSTOM_EDITOR   TYPE REF TO CL_GUI_TEXTEDIT,
      OBJ_CUSTOM_0140     TYPE REF TO CL_GUI_CUSTOM_CONTAINER,
      OBJ_ALV_0140        TYPE REF TO CL_GUI_ALV_GRID,
      OBJ_SPLITTER        TYPE REF TO CL_GUI_SPLITTER_CONTAINER,
      OBJ_TOOLBAR_MANAGER TYPE REF TO CL_ALV_GRID_TOOLBAR_MANAGER,
      OBJ_CUSTOM_SPLITTER TYPE REF TO CL_GUI_CONTAINER,

*     Tabelas internas/work-areas
      GT_MENU_TREE        TYPE TABLE OF TY_MENU_TREE,
      GT_FCAT_0100        TYPE TABLE OF LVC_S_FCAT,
      GT_FCAT_0110        TYPE TABLE OF LVC_S_FCAT,
      GT_FCAT_0140        TYPE TABLE OF LVC_S_FCAT,
      GT_FCAT_0300        TYPE TABLE OF LVC_S_FCAT,
      GT_SAIDA_0110       TYPE TABLE OF TY_SAIDA_0110,
      GT_SAIDA_0140       TYPE TABLE OF TY_SAIDA_0140,
      GT_SAIDA_0140_AUX   TYPE TABLE OF TY_SAIDA_0140,

      GT_SAIDA_0140_AUX2   TYPE TABLE OF TY_SAIDA_0140,


      GT_SAIDA_0170       TYPE TABLE OF TY_SAIDA_0170,
      GT_SAIDA_0180       TYPE TABLE OF TY_SAIDA_0180,
      GT_SAIDA_0300       TYPE TABLE OF TY_SAIDA_0300,
      TL_SELECTED_ROWS    TYPE LVC_T_ROW,
      WL_SELECTED_ROWS    TYPE LVC_S_ROW,
      GT_ZIMP_CAD_IMP_CON TYPE TABLE OF ZIMP_CAD_IMP_CON,
      GT_FIELDS           TYPE TABLE OF TY_FIELDS,
      GT_FIELDS_STYLE     TYPE TABLE OF TY_FIELDS_STYLE,
      "GT_TDLINE         TYPE TABLE OF TDLINE,
      GT_EDITOR           TYPE TABLE OF TY_EDITOR,
      GT_ESTILO           TYPE LVC_T_STYL WITH HEADER LINE,
      GT_ZAA001           TYPE TABLE OF ZAA001,
      GT_ZAA003           TYPE TABLE OF ZAA003,
      GT_BDC              TYPE TABLE OF BDCDATA,
      GT_CODE             TYPE TABLE OF SY-UCOMM,
      GT_MSG_RETURN       TYPE TABLE OF ZFIWRS0002,
      GT_VARIANT          TYPE DISVARIANT,
      GT_FCAT_SLIS        TYPE SLIS_T_FIELDCAT_ALV,



      WL_FCAT_SLIS        TYPE SLIS_FIELDCAT_ALV,
      WL_LAYOUT_SLIS      TYPE SLIS_LAYOUT_ALV,
      WL_MENU_TREE        TYPE TY_MENU_TREE,
      WL_LAYOUT           TYPE LVC_S_LAYO,
      WL_FCAT             TYPE LVC_S_FCAT,
      WL_ZIMP_CAD_IMP_CON TYPE ZIMP_CAD_IMP_CON, "Cadastro dos Impostos Itens
      WL_ZIMP_LANC_IMPOST TYPE ZIMP_LANC_IMPOST, "Cadastro Cabeçalho
      WL_STABLE           TYPE LVC_S_STBL,
      WL_SAIDA_0110       TYPE TY_SAIDA_0110,
      WL_SAIDA_0140       TYPE TY_SAIDA_0140,
      WL_SAIDA_0140_AUX   TYPE TY_SAIDA_0140,
      WL_SAIDA_0140_AUX2  TYPE TY_SAIDA_0140,
      WL_SAIDA_0170       TYPE TY_SAIDA_0170,
      WL_SAIDA_0180       TYPE TY_SAIDA_0180,
      WL_SAIDA_0300       TYPE TY_SAIDA_0300,
      WL_T001             TYPE T001,
      WL_CSKT             TYPE CSKT,
      WL_FIELDS           TYPE TY_FIELDS,
      WL_FIELDS_STYLE     TYPE TY_FIELDS_STYLE,
      WL_ZIB_CHAVE        TYPE ZIB_CONTABIL_CHV,
      WL_ZIB_ERRO         TYPE ZIB_CONTABIL_ERR,
      WL_ESTILO           TYPE LVC_S_STYL,
      WL_J_1BBRANCH       TYPE J_1BBRANCH,
      WL_DESCR_HEADER     TYPE TY_HEADER_0110,
      "WL_TDLINE         TYPE TDLINE,
      WL_EDITOR           TYPE TY_EDITOR,
      WL_ZAA001           TYPE ZAA001,
      WL_ZAA001_AUX       TYPE ZAA001,
      WL_SAIDA_ZAA001     TYPE ZAA001,
      WL_EXCLUDE          TYPE UI_FUNCTIONS,
      WL_ZAA002           TYPE ZAA002,
      WL_ZAA003           TYPE ZAA003,
      WL_STABLE_AUX       TYPE LVC_S_STBL,
      WL_MENSAGEM         TYPE CHAR30,
      WL_BDC              TYPE BDCDATA,
      WL_MSG_RETURN       TYPE ZFIWRS0002,
      GT_HEADER           TYPE SLIS_T_LISTHEADER,
      LT_HEADER           TYPE SLIS_LISTHEADER,


*     Variáveis
      SCREEN_PRINCIPAL    TYPE SY-DYNNR VALUE '0130',
      SCREEN_ITEM         TYPE SY-DYNNR,
      OK_CODE             TYPE OK_CODE,
      MODO_OPERACAO       TYPE CHAR15,
      RETURN_STATUS       TYPE I,
      OP_MODE             TYPE CHAR10,
      LINES               TYPE SY-TABIX,
      AT_STRLEN           TYPE NUMC10,
      WL_CELL             TYPE LVC_S_CELL,
      TL_CELL             TYPE LVC_T_CELL,
      OPT                 TYPE CTU_PARAMS,
      TP_OBRIGACAO        TYPE CHAR15,
      WL_OBJ(30),
      X                   TYPE C VALUE 'X'.

CONSTANTS:
  C_SAVE        TYPE CHAR20   VALUE 'SAVE',
  C_BACK        TYPE CHAR20   VALUE 'BACK',
  C_CANC        TYPE CHAR20   VALUE 'CANC',
  C_EXIT        TYPE CHAR20   VALUE 'EXIT',
  C_EDIT        TYPE CHAR20   VALUE 'EDIT',
  C_SHOW_MSG    TYPE CHAR20   VALUE 'SHOW_MSG',
  C_CAD_IMPOSTO TYPE CHAR20   VALUE 'IMPOSTO',
  C_CLEAR       TYPE CHAR20   VALUE 'CLEAR',
  C_ENTER       TYPE CHAR20   VALUE 'ENTER',
  C_SCREEN_0110 TYPE CHAR4    VALUE '0110', "Screen - Dados Complementares do Imobilizado
  C_SCREEN_0120 TYPE CHAR4    VALUE '0120', "Screen - Tela de seleção da screen 0110.
  C_SCREEN_0130 TYPE CHAR4    VALUE '0130', "Screen - Tela vazia
  C_SCREEN_0140 TYPE CHAR4    VALUE '0140', "Screen - Controle de Impostos
  C_SCREEN_0150 TYPE CHAR4    VALUE '0150', "Screen - Tela de seleção da screen 0140.
  C_SCREEN_0160 TYPE CHAR4    VALUE '0160', "Screen - Tela de Relatórios
  C_SCREEN_0170 TYPE CHAR4    VALUE '0170', "Screen - Tela de seleção relatório dados complementares.
  C_SCREEN_0180 TYPE CHAR4    VALUE '0180'. "Screen - Tela de seleção relatório Impostos.

SELECTION-SCREEN BEGIN OF SCREEN 0120 AS SUBSCREEN.
SELECT-OPTIONS: S_BUKRS FOR ANLA-BUKRS NO INTERVALS,
                S_WERKS FOR ANLZ-WERKS NO INTERVALS,
                S_KOSTL FOR ANLZ-KOSTL NO INTERVALS,
                S_ANLN1 FOR ANLA-ANLN1 NO INTERVALS,
                S_KFZKZ FOR ANLZ-KFZKZ NO INTERVALS,
                S_INCOR FOR SY-DATUM,
                S_DESAT FOR SY-DATUM.
SELECTION-SCREEN END OF SCREEN 0120.

SELECTION-SCREEN BEGIN OF SCREEN 0150 AS SUBSCREEN.
SELECT-OPTIONS: S_EMPRES FOR ANLA-BUKRS NO INTERVALS,
                S_FILIAL FOR ANLZ-WERKS NO INTERVALS,
                S_IMOBIL FOR ANLA-ANLN1 NO INTERVALS,
                S_PLACA  FOR ANLZ-KFZKZ NO INTERVALS,
                S_ANO    FOR ZAA003-ANO_VCTO NO INTERVALS OBLIGATORY default SY-DATUM(4),
                S_MESV   FOR ZAA001-MES_DPVAT NO INTERVALS.
*                  S_OBRIG  FOR ZAA002-TP_OBRIG,
*                  S_MES_VC FOR ZAA003-MES_VCTO,
*                  S_ANO_VC FOR ZAA003-ANO_VCTO.
SELECTION-SCREEN END OF SCREEN 0150.

SELECTION-SCREEN BEGIN OF SCREEN 0170 AS SUBSCREEN.
SELECT-OPTIONS: S1_BUKRS FOR ANLA-BUKRS,
                S1_WERKS FOR ANLZ-WERKS,
                S1_KOSTL FOR ANLZ-KOSTL,
                S1_ANLN1 FOR ANLA-ANLN1,
                S1_KFZKZ FOR ANLZ-KFZKZ,
                S1_INCOR FOR SY-DATUM,
                S1_DESAT FOR SY-DATUM,
                S1_DESCR FOR ANLA-TXT50 NO INTERVALS.       "CS2019001264 28.05.2020
SELECTION-SCREEN END OF SCREEN 0170.

SELECTION-SCREEN BEGIN OF SCREEN 0180 AS SUBSCREEN.
SELECT-OPTIONS: S2_BUKRS FOR ANLA-BUKRS,
                S2_WERKS FOR ANLZ-WERKS,
                S2_ANLN1 FOR ANLA-ANLN1,
                S2_KFZKZ FOR ANLZ-KFZKZ,
                S2_MES_V FOR ZAA003-MES_VCTO,
                S2_ANO_V FOR ZAA003-ANO_VCTO.

SELECTION-SCREEN SKIP 1.

SELECTION-SCREEN COMMENT /1(30) COMM1.
PARAMETERS: S2_IPVA  RADIOBUTTON GROUP GR1,
            S2_DPVAT RADIOBUTTON GROUP GR1,
            S2_LICEN RADIOBUTTON GROUP GR1,
            S2_TODOS RADIOBUTTON GROUP GR1 DEFAULT 'X'.
SELECTION-SCREEN END OF SCREEN 0180.


START-OF-SELECTION.
  CALL SCREEN 0100.

END-OF-SELECTION.

*AT SELECTION-SCREEN.
