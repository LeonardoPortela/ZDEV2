FUNCTION ZLES_PARAM_FORN_AQUA.
*"----------------------------------------------------------------------
*"*"Interface local:
*"  IMPORTING
*"     REFERENCE(I_BUKRS_ROM) TYPE  BUKRS
*"     REFERENCE(I_BRANCH_ROM) TYPE  J_1BBRANC_
*"     REFERENCE(I_LIFNR) TYPE  LIFNR
*"  EXPORTING
*"     REFERENCE(E_LIFNR_RAIZ) TYPE  LIFNR
*"     REFERENCE(E_ZLEST0152) TYPE  ZLEST0152
*"----------------------------------------------------------------------

  DATA: IT_LFA1       TYPE TABLE OF LFA1,
        VL_LIFNR_RAIZ TYPE LFA1-STCD1,
        STCD_STR      TYPE C LENGTH 9,
        STCD_CONC     TYPE C LENGTH 4.

  CLEAR: E_ZLEST0152, E_LIFNR_RAIZ.

  CHECK ( I_BUKRS_ROM   IS NOT INITIAL ) AND
        ( I_BRANCH_ROM  IS NOT INITIAL ) AND
        ( I_LIFNR       IS NOT INITIAL ).

  SELECT SINGLE *
    FROM LFA1 INTO @DATA(WL_LFA1)
   WHERE LIFNR EQ @I_LIFNR.

  CHECK SY-SUBRC = 0.

  "Fazer busca do mesmo em um CNPJ raiz.
  IF WL_LFA1-STKZN IS INITIAL .

    CONCATENATE WL_LFA1-STCD1(8) '%' INTO STCD_STR.

    SELECT *
      FROM LFA1 INTO TABLE IT_LFA1
     WHERE STCD1 LIKE STCD_STR.

    LOOP AT IT_LFA1 INTO WL_LFA1.
      CLEAR: STCD_CONC.
      CONCATENATE WL_LFA1-STCD1+8(1) WL_LFA1-STCD1+9(1) WL_LFA1-STCD1+10(1) WL_LFA1-STCD1+11(1) INTO STCD_CONC.

      CHECK ( STCD_CONC EQ '0001' ).
      VL_LIFNR_RAIZ = WL_LFA1-LIFNR.
    ENDLOOP.

  ELSE.
    VL_LIFNR_RAIZ = WL_LFA1-LIFNR.
  ENDIF.

  SELECT SINGLE *
    FROM ZLEST0104 INTO @DATA(_WL_0104)
   WHERE BUKRS   = @I_BUKRS_ROM
     AND BRANCH  = @I_BRANCH_ROM.

  IF SY-SUBRC = 0.
    SELECT SINGLE *
      FROM J_1BBRANCH INTO @DATA(WL_J_1BBRANCH)
     WHERE BRANCH = @_WL_0104-EMISSOR.

    CHECK ( SY-SUBRC = 0 ) AND ( WL_J_1BBRANCH-BUKRS IS NOT INITIAL ).

    SELECT SINGLE *
      FROM ZLEST0152 INTO E_ZLEST0152
     WHERE BUKRS       EQ WL_J_1BBRANCH-BUKRS
       AND RM_CODIGO   EQ I_LIFNR
       AND LOEKZ       EQ ''.

    IF SY-SUBRC NE 0.
      SELECT SINGLE *
       FROM ZLEST0152 INTO E_ZLEST0152
      WHERE BUKRS       EQ WL_J_1BBRANCH-BUKRS
        AND RM_CODIGO   EQ VL_LIFNR_RAIZ
        AND LOEKZ       EQ ''.
    ENDIF.
  ENDIF.


ENDFUNCTION.
