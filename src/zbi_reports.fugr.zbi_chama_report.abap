FUNCTION ZBI_CHAMA_REPORT.
*"----------------------------------------------------------------------
*"*"Interface local:
*"  IMPORTING
*"     REFERENCE(I_NM_TECNICO) TYPE  ZDE_DS_NOME_TECNICO_BI
*"     REFERENCE(I_TP_ACESSO) TYPE  ZDE_TP_ACESSO_BI DEFAULT '02'
*"     REFERENCE(I_BROWSER_USUARIO) TYPE  CHAR01 DEFAULT 'X'
*"     REFERENCE(I_RETORNAR_URI) TYPE  CHAR01 DEFAULT ' '
*"     REFERENCE(I_OTHERS_PARAMITERS) TYPE  STRING OPTIONAL
*"     REFERENCE(I_TYPE_REPORT) TYPE  ZDE_TP_REPORT DEFAULT ' '
*"     REFERENCE(I_REFRESH) TYPE  CHAR01 DEFAULT ' '
*"  EXPORTING
*"     REFERENCE(E_URI) TYPE  STRING
*"     REFERENCE(E_REPORT) TYPE  ZBIT0003
*"  EXCEPTIONS
*"      ERRO
*"----------------------------------------------------------------------

  DATA: LC_OTHERS_PARAMITERS TYPE STRING.

  SELECT SINGLE * INTO WA_ZBIT0003
    FROM ZBIT0003
   WHERE DS_NOME_TECNICO EQ I_NM_TECNICO.

  IF SY-SUBRC IS NOT INITIAL.
    MESSAGE E001(ZBI_REPORTS) WITH I_NM_TECNICO RAISING ERRO.
  ENDIF.

  SELECT SINGLE * INTO WA_ZBIT0002
    FROM ZBIT0002
   WHERE TP_ACESSO EQ I_TP_ACESSO.

  IF SY-SUBRC IS NOT INITIAL.
    MESSAGE E002(ZBI_REPORTS) WITH I_TP_ACESSO RAISING ERRO.
  ENDIF.

  SELECT SINGLE * INTO WA_ZBIT0001 FROM ZBIT0001.

  IF SY-SUBRC IS NOT INITIAL.
    MESSAGE E003(ZBI_REPORTS) RAISING ERRO.
  ENDIF.

  CASE I_TYPE_REPORT.
    WHEN '1'.
      LC_OTHERS_PARAMITERS = '?sType=wid'.
    WHEN '2'.
      LC_OTHERS_PARAMITERS = '?sType=lumx'.
  ENDCASE.

  IF I_REFRESH IS NOT INITIAL.
    CONCATENATE LC_OTHERS_PARAMITERS '?sRefresh=Y' INTO LC_OTHERS_PARAMITERS.
  ENDIF.

  IF I_OTHERS_PARAMITERS IS NOT INITIAL.
    CONCATENATE LC_OTHERS_PARAMITERS '&pOthers=' I_OTHERS_PARAMITERS INTO LC_OTHERS_PARAMITERS.
  ENDIF.

  CASE SY-SYSID.
    WHEN 'DEV'.
      CONCATENATE WA_ZBIT0001-DS_DOMINIO_DEV WA_ZBIT0002-DS_ARQUIVO '?' 'iDocID=' WA_ZBIT0003-DS_CUID_DEV '&sIDType=CUID&sMode=' WA_ZBIT0002-TP_ACESSO LC_OTHERS_PARAMITERS INTO LC_URI .
      CONCATENATE WA_ZBIT0001-DS_DOMINIO_DEV WA_ZBIT0002-DS_ARQUIVO '?' 'iDocID=' WA_ZBIT0003-DS_CUID_DEV '&sIDType=CUID&sMode=' WA_ZBIT0002-TP_ACESSO LC_OTHERS_PARAMITERS INTO E_URI.
    WHEN 'QAS'.
      CONCATENATE WA_ZBIT0001-DS_DOMINIO_QAS WA_ZBIT0002-DS_ARQUIVO '?' 'iDocID=' WA_ZBIT0003-DS_CUID_QAS '&sIDType=CUID&sMode=' WA_ZBIT0002-TP_ACESSO LC_OTHERS_PARAMITERS INTO LC_URI .
      CONCATENATE WA_ZBIT0001-DS_DOMINIO_QAS WA_ZBIT0002-DS_ARQUIVO '?' 'iDocID=' WA_ZBIT0003-DS_CUID_QAS '&sIDType=CUID&sMode=' WA_ZBIT0002-TP_ACESSO LC_OTHERS_PARAMITERS INTO E_URI.
    WHEN 'PRD'.
      CONCATENATE WA_ZBIT0001-DS_DOMINIO WA_ZBIT0002-DS_ARQUIVO '?' 'iDocID=' WA_ZBIT0003-DS_CUID '&sIDType=CUID&sMode=' WA_ZBIT0002-TP_ACESSO LC_OTHERS_PARAMITERS INTO LC_URI .
      CONCATENATE WA_ZBIT0001-DS_DOMINIO WA_ZBIT0002-DS_ARQUIVO '?' 'iDocID=' WA_ZBIT0003-DS_CUID '&sIDType=CUID&sMode=' WA_ZBIT0002-TP_ACESSO LC_OTHERS_PARAMITERS INTO E_URI.
  ENDCASE.

  CASE I_RETORNAR_URI.
    WHEN ABAP_FALSE.

      CASE I_BROWSER_USUARIO.
        WHEN ABAP_TRUE.
          CALL FUNCTION 'PRGN_GENER_EXECUTE_URL'
            EXPORTING
              NODE_DATA = LC_URI.
        WHEN ABAP_FALSE.
          CALL SCREEN 0100.
      ENDCASE.

  ENDCASE.

  E_REPORT = WA_ZBIT0003.

ENDFUNCTION.
