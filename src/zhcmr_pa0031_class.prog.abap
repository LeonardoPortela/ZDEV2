*&---------------------------------------------------------------------*
*&  Include           ZHCMR_PA0031_CLASS
*&---------------------------------------------------------------------*


CLASS LCL_ALV_TOOLBAR_0100 IMPLEMENTATION.
  METHOD CONSTRUCTOR.
*   Create ALV toolbar manager instance
    CREATE OBJECT C_ALV_TOOLBARMANAGER
      EXPORTING
        IO_ALV_GRID = IO_ALV_GRID.
  ENDMETHOD.                    "constructor

  METHOD ON_TOOLBAR.

    TY_TOOLBAR-ICON      = ICON_GENERATE.
    TY_TOOLBAR-FUNCTION  = C_COMP_BANCO.
    TY_TOOLBAR-TEXT      = 'Compensar Banco'.
    TY_TOOLBAR-BUTN_TYPE = 0.
    APPEND TY_TOOLBAR TO E_OBJECT->MT_TOOLBAR.
    CLEAR TY_TOOLBAR.

    TY_TOOLBAR-ICON      = ICON_GENERATE.
    TY_TOOLBAR-FUNCTION  = C_COMP_LCTOS.
    TY_TOOLBAR-TEXT      = 'Compensar LanÃ§amentos'.
    TY_TOOLBAR-BUTN_TYPE = 0.
    APPEND TY_TOOLBAR TO E_OBJECT->MT_TOOLBAR.
    CLEAR TY_TOOLBAR.

  ENDMETHOD.                    "on_toolbar

  METHOD HANDLE_USER_COMMAND.

    CASE E_UCOMM.

      WHEN C_COMP_LCTOS.

        PERFORM F_COMPENSAR_LCTOS USING ''.

      WHEN C_COMP_BANCO.

        PERFORM F_COMPENSAR_LCTOS USING 'X'.

    ENDCASE.

  ENDMETHOD.                    "HANDLE_USER_COMMAND

ENDCLASS.                    "lcl_alv_toolbar IMPLEMENTATION


CLASS LCL_EVENT_HANDLER_0100 IMPLEMENTATION.

  METHOD CATCH_HOTSPOT.

    CASE E_COLUMN_ID.
      WHEN 'BELNR'.
        READ TABLE IT_SAIDA_0100 INTO WA_SAIDA_0100 INDEX E_ROW_ID-INDEX.
        CHECK SY-SUBRC = 0.

        SET PARAMETER ID 'BLN' FIELD WA_SAIDA_0100-BELNR.
        SET PARAMETER ID 'BUK' FIELD WA_SAIDA_0100-BUKRS.
        SET PARAMETER ID 'GJR' FIELD WA_SAIDA_0100-BUDAT(4).

        CALL TRANSACTION 'FB03' AND SKIP FIRST SCREEN.

      WHEN 'AUGBL'.
        READ TABLE IT_SAIDA_0100 INTO WA_SAIDA_0100 INDEX E_ROW_ID-INDEX.
        CHECK SY-SUBRC = 0.

        SET PARAMETER ID 'BLN' FIELD WA_SAIDA_0100-AUGBL.
        SET PARAMETER ID 'BUK' FIELD WA_SAIDA_0100-BUKRS.
        SET PARAMETER ID 'GJR' FIELD WA_SAIDA_0100-ZFBDT(4).

        CALL TRANSACTION 'FB03' AND SKIP FIRST SCREEN.
    ENDCASE.

  ENDMETHOD.

  METHOD DATA_CHANGED_FINISHED.

    CHECK ET_GOOD_CELLS[] IS NOT INITIAL.

    LOOP AT ET_GOOD_CELLS[] INTO DATA(W_GOOD).

      TRY.
          DATA(W_SAIDA) = IT_SAIDA_0100[ W_GOOD-TABIX ].
        CATCH CX_SY_ITAB_LINE_NOT_FOUND.
      ENDTRY.

      CHECK W_SAIDA IS NOT INITIAL.

      IF W_SAIDA-NOME_ARQUIVO IS NOT INITIAL.

        DATA(W_PY0019) = VALUE ZHCMT_PY_0019(
            BUKRS        = W_SAIDA-BUKRS
            LIFNR        = W_SAIDA-LIFNR
            BELNR        = W_SAIDA-BELNR
            ZFBDT        = W_SAIDA-ZFBDT
            NOME_ARQUIVO = W_SAIDA-NOME_ARQUIVO
            DT_REGISTRO  = SY-DATUM
            HR_REGISTRO  = SY-UZEIT
            US_REGISTRO  = SY-UNAME  ).

        MODIFY ZHCMT_PY_0019 FROM W_PY0019.

      ENDIF.

    ENDLOOP.

    COMMIT WORK.

  ENDMETHOD.

ENDCLASS.
