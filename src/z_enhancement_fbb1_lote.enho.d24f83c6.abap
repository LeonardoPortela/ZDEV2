"Name: \PR:SAPMF05A\FO:UEBERNUMMER_VERGEBEN\SE:BEGIN\EI
ENHANCEMENT 0 Z_ENHANCEMENT_FBB1_LOTE.
*
  DATA: IT_ZGLT034 TYPE TABLE OF ZGLT034,
        WA_ZGLT034 TYPE ZGLT034.
  DATA: V_LIBERADO TYPE CHAR01,
        VNUM_LOTE  TYPE ZLOTE_NUM.

  IF  'FBB1' CS SY-TCODE   AND SY-UCOMM = 'BU'.
     LOOP AT XBKPF.
       WA_ZGLT034-LOTE         = XBKPF-BELNR.
       WA_ZGLT034-DEP_RESP     = XBKPF-BKTXT.
       WA_ZGLT034-DESCR_LOTE   = XBKPF-BKTXT.
       WA_ZGLT034-BUKRS        = XBKPF-BUKRS.
       WA_ZGLT034-USNAM        = XBKPF-USNAM.
       WA_ZGLT034-DEP_RESP     = '83'.
       WA_ZGLT034-STATUS_LOTE  = ' '.
       WA_ZGLT034-DATA_ATUAL   = XBKPF-BUDAT.
       WA_ZGLT034-HORA_ATUAL   = SY-UZEIT.
       WA_ZGLT034-USUARIO      = SY-UNAME.
       WA_ZGLT034-TCODE        = XBKPF-TCODE.

          LOOP AT XBSEG.
            IF XBSEG-SHKZG = 'H'.
             WA_ZGLT034-VALOR      = XBSEG-WRBTR . "(SHKZG = ‘H’ )
           ENDIF.
          ENDLOOP.

       APPEND WA_ZGLT034 TO IT_ZGLT034.
       CLEAR WA_ZGLT034.
   ENDLOOP.
   MODIFY ZGLT034 FROM TABLE IT_ZGLT034.

   CLEAR  VNUM_LOTE.
   VNUM_LOTE = XBKPF-BELNR.

  CALL FUNCTION 'Z_GL_LIBERAR_LOTE'
    EXPORTING
      P_NUM_LOTE =  VNUM_LOTE
    IMPORTING
      P_LIBERADO = V_LIBERADO.
 ENDIF.

ENDENHANCEMENT.
