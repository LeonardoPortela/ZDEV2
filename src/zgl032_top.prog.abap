*&---------------------------------------------------------------------*
*&  Include           ZGL032_TOP
*&---------------------------------------------------------------------*

TYPES: BEGIN OF TY_ESTRUTURA.
        INCLUDE TYPE SLIS_FIELDCAT_MAIN.
        INCLUDE TYPE SLIS_FIELDCAT_ALV_SPEC.
TYPES: END OF TY_ESTRUTURA.


TYPES: BEGIN OF TY_VAR_CALC,
         BUKRS    TYPE BSAD-BUKRS,
         AUGBL    TYPE BSAD-AUGBL,
         HKTRC    TYPE BSAD-HKONT,
         GSBER    TYPE BSAD-GSBER,
         VCALC    TYPE BSAD-DMBTR,
         VCALC_2  TYPE BSAD-DMBE2,
       END OF TY_VAR_CALC.

TYPES: BEGIN OF TY_SAIDA,
         BUKRS       TYPE BSAD-BUKRS,
         GJAHR       TYPE BSAD-GJAHR,
         KUNNR       TYPE BSAD-KUNNR,
         LIFNR       TYPE BSAK-LIFNR,
         NAME1       TYPE LFA1-NAME1,
         HKTRC       TYPE BSAD-HKONT,
         TXT50       TYPE SKAT-TXT50,
         BELNR       TYPE BSAD-BELNR,
         BUZEI       TYPE BSAD-BUZEI,
         AUGBL       TYPE BSAD-AUGBL,
         BLART       TYPE BSAD-BLART,
         WAERS       TYPE BSAD-WAERS,
         BUDAT       TYPE BSAD-BUDAT,
         BLDAT       TYPE BSAD-BLDAT,
         AUGDT       TYPE BSAD-AUGDT,
         WRBTR       TYPE BSAD-WRBTR,
         DMBTR       TYPE BSAD-DMBTR,
         DMBE2       TYPE BSAD-DMBE2,
         GSBER       TYPE BSAD-GSBER,
         SGTXT       TYPE BSAD-SGTXT,
         TXHIS       TYPE P DECIMALS 5,
         KURSF       TYPE BKPF-KURSF,
         TXHIS_VS    TYPE P DECIMALS 4,
         KURSF_VS    TYPE P DECIMALS 4,
         VCALC       TYPE BSAD-DMBE2,
         HKTVR       TYPE BSAD-HKONT,
         VLANC       TYPE BSAD-DMBTR,
         VLDIF       TYPE BSAD-DMBTR,
         VBELN       TYPE BSAD-VBELN,
         VBEL2       TYPE BSAD-VBEL2,
         EBELN       TYPE BSAK-EBELN,
         EBELP       TYPE BSAK-EBELP,
         SHKZG_PT    TYPE BSAK-SHKZG,
         SHKZG       TYPE BSIS-SHKZG,
         HKRCL       TYPE BSAK-HKONT,
         REBZG       TYPE BSAK-REBZG,
         RECLS       TYPE C,
         KOART       TYPE BSEG-KOART,
         DOC_RCL     TYPE ZGLT077-DOC_RCL,
         LOTE        TYPE ZGLT077-LOTE,
         STATUS      TYPE ZGLT077-STATUS,
         DOC_LCTO    TYPE ZGLT077-DOC_LCTO,
         DT_LCTO_CTB TYPE ZGLT077-DT_LCTO_CTB,
         VCALC_2     TYPE BSIS-DMBE2,
         VLANC_2     TYPE BSIS-DMBE2,
         VLDIF_2     TYPE BSIS-DMBE2,
         RESIDUAL    TYPE C,
         DEL         TYPE C.
TYPES: COLOR           TYPE KKBLO_SPECIALCOL OCCURS 0.
TYPES: END OF TY_SAIDA.

DATA: BEGIN OF TG_SKA1 OCCURS 0,
        KTOPL TYPE SKA1-KTOPL,
        KTOKS TYPE SKA1-KTOKS,
        SAKNR TYPE SKA1-SAKNR,
        TXT50 TYPE SKAT-TXT50,
      END OF TG_SKA1,

      BEGIN OF TG_SKAT OCCURS 0,
        SAKNR TYPE SKAT-SAKNR,
        TXT50 TYPE SKAT-TXT50,
      END OF TG_SKAT,

      BEGIN OF TG_KNA1 OCCURS 0,
        KUNNR TYPE KNA1-KUNNR,
        NAME1 TYPE KNA1-NAME1,
      END OF TG_KNA1,

      BEGIN OF TG_LFA1 OCCURS 0,
        LIFNR TYPE LFA1-LIFNR,
        NAME1 TYPE LFA1-NAME1,
      END OF TG_LFA1,

      BEGIN OF TG_BSIS OCCURS 0,
        BUKRS TYPE BSIS-BUKRS,
        BELNR TYPE BSIS-BELNR,
        BUZEI TYPE BSIS-BELNR,
        HKONT TYPE BSIS-HKONT,
        BUDAT TYPE BSIS-BUDAT,
        WAERS TYPE BSIS-WAERS,
        WRBTR TYPE BSIS-WRBTR,
        DMBTR TYPE BSIS-DMBTR,
        DMBE2 TYPE BSIS-DMBE2,
        SHKZG TYPE BSIS-SHKZG,
        GJAHR TYPE BSIS-GJAHR,
        BLART TYPE BSIS-BLART,
        GSBER TYPE BSIS-GSBER,
      END OF TG_BSIS,

      BEGIN OF TG_BSAD OCCURS 0,
        BUKRS TYPE BSAD-BUKRS,
        AUGBL TYPE BSAD-AUGBL,
        GJAHR TYPE BSAD-GJAHR,
        KUNNR TYPE BSAD-KUNNR,
        HKONT TYPE BSAD-HKONT,
        AUGDT TYPE BSAD-AUGDT,
        BELNR TYPE BSAD-BELNR,
        BUZEI TYPE BSAD-BUZEI,
        BUDAT TYPE BSAD-BUDAT,
        BLDAT TYPE BSAD-BLDAT,
        WAERS TYPE BSAD-WAERS,
        XBLNR TYPE BSAD-XBLNR,
        BLART TYPE BSAD-BLART,
        SHKZG TYPE BSAD-SHKZG,
        GSBER TYPE BSAD-GSBER,
        WRBTR TYPE BSAD-WRBTR,
        DMBTR TYPE BSAD-DMBTR,
        DMBE2 TYPE BSAD-DMBE2,
        SGTXT TYPE BSAD-SGTXT,
        VBELN TYPE BSAD-VBELN,
        VBEL2 TYPE BSAD-VBEL2,
        UMSKS TYPE BSAD-UMSKS,
        REBZG TYPE BSAD-REBZG,
        RESIDUAL TYPE C,
      END OF TG_BSAD,


      BEGIN OF TG_T030H OCCURS 0,
        HKONT TYPE T030H-HKONT,
        LHREA TYPE T030H-LHREA,
      END OF TG_T030H,

      BEGIN OF TG_EKPO OCCURS 0,
        EBELN TYPE EKPO-EBELN,
        EBELP TYPE EKPO-EBELP,
        MATKL TYPE EKPO-MATKL,
      END OF TG_EKPO,

      BEGIN OF TG_076 OCCURS 0,
        MATKL TYPE ZGLT076-MATKL,
        HKONT TYPE ZGLT076-HKONT,
      END OF TG_076,

      BEGIN OF TG_077 OCCURS 0.
        INCLUDE STRUCTURE ZGLT077.
DATA END OF TG_077.

DATA: BEGIN OF TG_BSAK OCCURS 0,
        BUKRS TYPE BSAK-BUKRS,
        AUGBL TYPE BSAK-AUGBL,
        GJAHR TYPE BSAK-GJAHR,
        LIFNR TYPE BSAK-LIFNR,
        HKONT TYPE BSAK-HKONT,
        AUGDT TYPE BSAK-AUGDT,
        BELNR TYPE BSAK-BELNR,
        BUZEI TYPE BSAK-BUZEI,
        BUDAT TYPE BSAK-BUDAT,
        BLDAT TYPE BSAK-BLDAT,
        WAERS TYPE BSAK-WAERS,
        XBLNR TYPE BSAK-XBLNR,
        BLART TYPE BSAK-BLART,
        SHKZG TYPE BSAK-SHKZG,
        GSBER TYPE BSAK-GSBER,
        WRBTR TYPE BSAD-WRBTR,
        DMBTR TYPE BSAK-DMBTR,
        DMBE2 TYPE BSAK-DMBE2,
        SGTXT TYPE BSAK-SGTXT,
        EBELN TYPE BSAK-EBELN,
        EBELP TYPE BSAK-EBELP,
        UMSKS TYPE BSAK-UMSKS,
        REBZG TYPE BSAK-REBZG,
        RESIDUAL TYPE C,
      END OF TG_BSAK,

      BEGIN OF TG_BKPF OCCURS 0,
        BUKRS TYPE BKPF-BUKRS,
        BELNR TYPE BKPF-BELNR,
        GJAHR TYPE BKPF-GJAHR,
        KURSF TYPE BKPF-KURSF,
        KURS2 TYPE BKPF-KURS2,
        WAERS TYPE BKPF-WAERS,
        STBLG TYPE BKPF-STBLG,
        BLART TYPE BKPF-BLART,
      END OF TG_BKPF,

      BEGIN OF TG_TX_USD_BRL OCCURS 0,
        DATA  TYPE BKPF-BUDAT,
        TAXA  TYPE UKURS_CURR,
      END OF TG_TX_USD_BRL,

      BEGIN OF TG_BSIS_CBANCO OCCURS 0,
        BUKRS     LIKE BSIS-BUKRS,
        BELNR     LIKE BSIS-BELNR,
        GJAHR     LIKE BSIS-GJAHR,
        HKONT     LIKE BSIS-HKONT,
        DMBTR     TYPE BSIS-DMBTR,
        DMBE2     TYPE BSIS-DMBE2,
        WAERS     TYPE BSIS-WAERS,
        WRBTR     TYPE BSIS-WRBTR,
      END OF TG_BSIS_CBANCO,

      BEGIN OF TG_INF_DOC OCCURS 0,
        BUKRS  TYPE BSAK-BUKRS,
        AUGBL  TYPE BSAK-AUGBL,
        MSG    TYPE C LENGTH 200,
      END OF TG_INF_DOC.

*---------------------------------------------------------------------*
*  Inicio Definition Classes
*---------------------------------------------------------------------*

CLASS LCL_ALV_TOOLBAR DEFINITION.
  PUBLIC SECTION.
*Constructor
    METHODS: CONSTRUCTOR
      IMPORTING IO_ALV_GRID TYPE REF TO CL_GUI_ALV_GRID,
*Event for toolbar
      ON_TOOLBAR FOR EVENT TOOLBAR OF CL_GUI_ALV_GRID
        IMPORTING E_OBJECT,

      HANDLE_USER_COMMAND FOR EVENT USER_COMMAND OF CL_GUI_ALV_GRID
        IMPORTING E_UCOMM.

ENDCLASS.                    "LCL_ALV_TOOLBAR DEFINITION

CLASS LCL_EVENT_HANDLER DEFINITION.
  PUBLIC SECTION.
    CLASS-METHODS: HANDLE_HOTSPOT_CLICK FOR EVENT HOTSPOT_CLICK OF CL_GUI_ALV_GRID IMPORTING E_ROW_ID E_COLUMN_ID ES_ROW_NO.
ENDCLASS.                    "LCL_EVENT_HANDLER DEFINITION



DATA: OBJ_ALV       TYPE REF TO CL_GUI_ALV_GRID,
      OBJ_CONTAINER TYPE REF TO CL_GUI_CUSTOM_CONTAINER.

DATA: GS_SCROLL_COL    TYPE LVC_S_COL,
      GS_SCROLL_ROW    TYPE LVC_S_ROID.

DATA: GT_CATALOG TYPE LVC_T_FCAT,
      GW_CATALOG TYPE LVC_S_FCAT.

DATA: IT_SELECTED_ROWS TYPE LVC_T_ROW,
      WA_SELECTED_ROWS TYPE LVC_S_ROW.

DATA: OBJ_TOOLBAR       TYPE REF TO LCL_ALV_TOOLBAR,
      LCL_EVENT_HANDLER TYPE REF TO LCL_EVENT_HANDLER.

* ALV field catalogs
DATA: IT_FCAT TYPE LVC_T_FCAT,
      WA_FCAT TYPE LVC_S_FCAT.

DATA: IT_SORT TYPE LVC_T_SORT,
      WA_SORT TYPE LVC_S_SORT.

* ALV excluded functions
DATA: IT_EXCLUDE_FCODE TYPE UI_FUNCTIONS,
      WA_EXCLUDE_FCODE LIKE LINE OF IT_EXCLUDE_FCODE.

* Alv Styles
DATA: LS_EDIT TYPE LVC_S_STYL,
      LT_EDIT TYPE LVC_T_STYL.

* ALV layout variant
DATA: GS_VARIANT       TYPE DISVARIANT.

* ALV layout
DATA: GS_LAYOUT        TYPE LVC_S_LAYO.

* ALV Stable
DATA: WA_STABLE        TYPE LVC_S_STBL.

DATA: IT_SELECTEDCELL TYPE LVC_T_CELL,
      WA_SELECTEDCELL TYPE LVC_S_CELL.

DATA: IT_SEL_ROWS TYPE LVC_T_ROW,
      WA_SEL_ROWS TYPE LVC_S_ROW.

DATA: GT_F4  TYPE LVC_T_F4 WITH HEADER LINE.

* Objetos
DATA: C_ALV_TOOLBARMANAGER TYPE REF TO CL_ALV_GRID_TOOLBAR_MANAGER,
      TY_TOOLBAR           TYPE STB_BUTTON.

DATA: IT_DTA TYPE STANDARD TABLE OF BDCDATA WITH HEADER LINE,
      WA_DTA TYPE BDCDATA,
      WG_BDC TYPE BDCDATA,
      TG_BDC TYPE TABLE OF BDCDATA,
      TG_MSG TYPE TABLE OF BDCMSGCOLL WITH HEADER LINE,
      WG_MSG TYPE BDCMSGCOLL,
      OPT    TYPE CTU_PARAMS.

*---------------------------------------------------------------------*
*  Vari√°veis
*---------------------------------------------------------------------*

DATA: VG_NOT_FOUND    TYPE C,
      VG_SPACE        TYPE C,
      WL_BUKRS(50)    TYPE C,
      WL_BUDAT(100)   TYPE C,
      WL_HKTVR(50)    TYPE C,
      WL_HKTRC(50)    TYPE C,
      WL_PARID(50)    TYPE C,
      WL_WAERS(50)    TYPE C,
      VG_WAERS        TYPE T001-WAERS,
      VG_NCOL_VARCALC TYPE CHAR40,
      VG_NCOL_VARLANC TYPE CHAR40,
      VG_NCOL_VLRDIFE TYPE CHAR40.


*---------------------------------------------------------------------*
*  Ranges
*---------------------------------------------------------------------*

RANGES: R_GJAHR FOR BSAD-GJAHR,
        R_BLART_CBANCO FOR BKPF-BLART,
        R_FDLEV_BANCO  FOR SKB1-FDLEV.

*----------------------------------------------------------------------*
* Estruturas ALV
*----------------------------------------------------------------------*
DATA: XS_EVENTS    TYPE SLIS_ALV_EVENT,
      EVENTS       TYPE SLIS_T_EVENT,
      T_PRINT      TYPE SLIS_PRINT_ALV,
      ESTRUTURA    TYPE TABLE OF TY_ESTRUTURA,
      WA_ESTRUTURA TYPE TY_ESTRUTURA,
      V_REPORT     LIKE SY-REPID,
      T_TOP        TYPE SLIS_T_LISTHEADER.

*---------------------------------------------------------------------*
*  Internal Tables and Work Areas
*---------------------------------------------------------------------*

DATA: IT_SAIDA      TYPE TABLE OF TY_SAIDA,
      IT_SAIDA_AUX  TYPE TABLE OF TY_SAIDA,
      IT_SAIDA_RSD  TYPE TABLE OF TY_SAIDA,
      WA_SAIDA      TYPE TY_SAIDA,
      TG_BSAK_AUX   LIKE TABLE OF TG_BSAK WITH HEADER LINE,
      TG_BSAD_AUX   LIKE TABLE OF TG_BSAD WITH HEADER LINE,
      TG_BSAK_RSD   LIKE TABLE OF TG_BSAK WITH HEADER LINE,
      TG_BSAD_RSD   LIKE TABLE OF TG_BSAD WITH HEADER LINE,
      TG_BSAK_COMP  LIKE TABLE OF TG_BSAK WITH HEADER LINE,
      TG_BSAD_COMP  LIKE TABLE OF TG_BSAD WITH HEADER LINE,
      TG_VAR_CALC   TYPE TABLE OF TY_VAR_CALC WITH HEADER LINE.
